<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basketball Legends: The Pantheon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1A2238; /* Dark Navy Blue */
        }
        .menu-button {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            background-color: #4A5568;
            border: 1px solid #718096;
        }
        .menu-button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
            background-color: #2D3748;
        }
        .action-button {
             background-color: #FBBF24; /* Golden Yellow */
             color: #1A2238;
        }
        .action-button:hover {
            background-color: #F59E0B; /* Darker Golden Yellow */
        }
        .player-slot {
            transition: all 0.2s ease-in-out;
            border: 2px dashed #4A5568;
            background-color: #2D3748;
        }
        .player-slot:hover {
            border-color: #FBBF24;
            background-color: #4A5568;
        }
        .player-slot.filled {
            border-style: solid;
            border-color: #FBBF24;
            background-color: #1A2238;
        }
        #player-modal {
            background-color: rgba(0,0,0,0.8);
        }
    </style>
</head>
<body class="text-gray-200 antialiased">

    <div id="app-container" class="container mx-auto p-4 md:p-8 max-w-5xl relative">
        <!-- App content is rendered here by JavaScript -->
    </div>

    <script type="module">
        // --- DATA MODULE ---
        const players = {
            "kareem_abdul_jabbar": { name: "Kareem Abdul-Jabbar", pos: "C", tier: "GOAT", attributes: { inside_scoring: 100, mid_range: 88, three_point: 10, playmaking: 78, perimeter_defense: 60, interior_defense: 96, rebounding: 94, athleticism: 88, basketball_iq: 98 }, career_stats: { usg_pct: 28.5, fg_pct: 55.9 }, shot_tendencies: { inside: 80, mid: 20, three: 0 }, target_minutes: 38, traits: ["Unstoppable Scorer", "Rim Protector"], foul_tendency: 6, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=KAJ" },
            "wilt_chamberlain": { name: "Wilt Chamberlain", pos: "C", tier: "GOAT", attributes: { inside_scoring: 100, mid_range: 75, three_point: 5, playmaking: 70, perimeter_defense: 50, interior_defense: 95, rebounding: 100, athleticism: 100, basketball_iq: 85 }, career_stats: { usg_pct: 30.0, fg_pct: 54.0 }, shot_tendencies: { inside: 90, mid: 10, three: 0 }, target_minutes: 40, traits: ["Post Anchor", "Tireless Motor"], foul_tendency: 5, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=WC" },
            "michael_jordan": { name: "Michael Jordan", pos: "SG", tier: "GOAT", attributes: { inside_scoring: 98, mid_range: 100, three_point: 75, playmaking: 90, perimeter_defense: 98, interior_defense: 70, rebounding: 75, athleticism: 98, basketball_iq: 97 }, career_stats: { usg_pct: 33.3, fg_pct: 49.7 }, shot_tendencies: { inside: 45, mid: 50, three: 5 }, target_minutes: 38, traits: ["Clutch Performer", "Alpha Dog", "Unstoppable Scorer"], foul_tendency: 4, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=MJ" },
            "bill_russell": { name: "Bill Russell", pos: "C", tier: "GOAT", attributes: { inside_scoring: 75, mid_range: 50, three_point: 5, playmaking: 75, perimeter_defense: 70, interior_defense: 100, rebounding: 99, athleticism: 90, basketball_iq: 100 }, career_stats: { usg_pct: 16.6, fg_pct: 44.0 }, shot_tendencies: { inside: 95, mid: 5, three: 0 }, target_minutes: 36, traits: ["Rim Protector", "Alpha Dog"], foul_tendency: 7, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=BR" },
            "magic_johnson": { name: "Magic Johnson", pos: "PG", tier: "GOAT", attributes: { inside_scoring: 92, mid_range: 80, three_point: 70, playmaking: 100, perimeter_defense: 80, interior_defense: 60, rebounding: 80, athleticism: 88, basketball_iq: 99 }, career_stats: { usg_pct: 22.8, fg_pct: 52.0 }, shot_tendencies: { inside: 60, mid: 30, three: 10 }, target_minutes: 37, traits: ["Floor General", "Transition Threat"], foul_tendency: 4, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=MJ" },
            "larry_bird": { name: "Larry Bird", pos: "SF", tier: "GOAT", attributes: { inside_scoring: 88, mid_range: 96, three_point: 90, playmaking: 94, perimeter_defense: 80, interior_defense: 72, rebounding: 88, athleticism: 80, basketball_iq: 100 }, career_stats: { usg_pct: 26.5, fg_pct: 49.6 }, shot_tendencies: { inside: 35, mid: 45, three: 20 }, target_minutes: 38, traits: ["Clutch Performer", "Floor General"], foul_tendency: 5, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=LB" },
            "hakeem_olajuwon": { name: "Hakeem Olajuwon", pos: "C", tier: "Legend", attributes: { inside_scoring: 97, mid_range: 85, three_point: 20, playmaking: 70, perimeter_defense: 75, interior_defense: 99, rebounding: 93, athleticism: 92, basketball_iq: 95 }, career_stats: { usg_pct: 28.9, fg_pct: 51.2 }, shot_tendencies: { inside: 75, mid: 25, three: 0 }, target_minutes: 36, traits: ["Unstoppable Scorer", "Rim Protector"], foul_tendency: 8, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=HO" },
            "oscar_robertson": { name: "Oscar Robertson", pos: "PG", tier: "Legend", attributes: { inside_scoring: 90, mid_range: 92, three_point: 50, playmaking: 98, perimeter_defense: 85, interior_defense: 60, rebounding: 82, athleticism: 85, basketball_iq: 96 }, career_stats: { usg_pct: 26.0, fg_pct: 48.5 }, shot_tendencies: { inside: 50, mid: 50, three: 0 }, target_minutes: 38, traits: ["Floor General", "Tireless Motor"], foul_tendency: 5, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=OR" },
            "shaquille_oneal": { name: "Shaquille O'Neal", pos: "C", tier: "Legend", attributes: { inside_scoring: 100, mid_range: 25, three_point: 5, playmaking: 65, perimeter_defense: 30, interior_defense: 92, rebounding: 94, athleticism: 95, basketball_iq: 80 }, career_stats: { usg_pct: 29.5, fg_pct: 58.2 }, shot_tendencies: { inside: 99, mid: 1, three: 0 }, target_minutes: 35, traits: ["Post Anchor", "Rim Protector"], foul_tendency: 9, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=SO" },
            "jerry_west": { name: "Jerry West", pos: "SG", tier: "Legend", attributes: { inside_scoring: 85, mid_range: 95, three_point: 80, playmaking: 90, perimeter_defense: 92, interior_defense: 60, rebounding: 70, athleticism: 88, basketball_iq: 94 }, career_stats: { usg_pct: 30.0, fg_pct: 47.4 }, shot_tendencies: { inside: 40, mid: 60, three: 0 }, target_minutes: 37, traits: ["Clutch Performer", "Unstoppable Scorer"], foul_tendency: 5, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=JW" },
            "elgin_baylor": { name: "Elgin Baylor", pos: "SF", tier: "Legend", attributes: { inside_scoring: 96, mid_range: 90, three_point: 40, playmaking: 80, perimeter_defense: 78, interior_defense: 65, rebounding: 92, athleticism: 93, basketball_iq: 90 }, career_stats: { usg_pct: 29.0, fg_pct: 43.1 }, shot_tendencies: { inside: 60, mid: 40, three: 0 }, target_minutes: 36, traits: ["Unstoppable Scorer", "Tireless Motor"], foul_tendency: 6, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=EB" },
            "karl_malone": { name: "Karl Malone", pos: "PF", tier: "Legend", attributes: { inside_scoring: 95, mid_range: 88, three_point: 40, playmaking: 70, perimeter_defense: 78, interior_defense: 75, rebounding: 90, athleticism: 94, basketball_iq: 85 }, career_stats: { usg_pct: 28.7, fg_pct: 51.6 }, shot_tendencies: { inside: 60, mid: 40, three: 0 }, target_minutes: 37, traits: ["Post Anchor", "Transition Threat"], foul_tendency: 8, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=KM" },
            "moses_malone": { name: "Moses Malone", pos: "C", tier: "Legend", attributes: { inside_scoring: 94, mid_range: 70, three_point: 20, playmaking: 60, perimeter_defense: 60, interior_defense: 88, rebounding: 98, athleticism: 85, basketball_iq: 88 }, career_stats: { usg_pct: 26.1, fg_pct: 49.1 }, shot_tendencies: { inside: 85, mid: 15, three: 0 }, target_minutes: 34, traits: ["Post Anchor", "Tireless Motor"], foul_tendency: 7, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=MM" },
            "julius_erving": { name: "Julius Erving", pos: "SF", tier: "Legend", attributes: { inside_scoring: 97, mid_range: 80, three_point: 65, playmaking: 80, perimeter_defense: 85, interior_defense: 75, rebounding: 85, athleticism: 96, basketball_iq: 90 }, career_stats: { usg_pct: 28.8, fg_pct: 50.6 }, shot_tendencies: { inside: 70, mid: 25, three: 5 }, target_minutes: 36, traits: ["Transition Threat", "Unstoppable Scorer"], foul_tendency: 6, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=JE" },
            "charles_barkley": { name: "Charles Barkley", pos: "PF", tier: "Legend", attributes: { inside_scoring: 92, mid_range: 80, three_point: 70, playmaking: 75, perimeter_defense: 70, interior_defense: 65, rebounding: 95, athleticism: 90, basketball_iq: 87 }, career_stats: { usg_pct: 26.6, fg_pct: 54.1 }, shot_tendencies: { inside: 65, mid: 25, three: 10 }, target_minutes: 35, traits: ["Tireless Motor", "Post Anchor"], foul_tendency: 8, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=CB" },
            "scottie_pippen": { name: "Scottie Pippen", pos: "SF", tier: "Legend", attributes: { inside_scoring: 85, mid_range: 82, three_point: 75, playmaking: 88, perimeter_defense: 100, interior_defense: 80, rebounding: 80, athleticism: 92, basketball_iq: 93 }, career_stats: { usg_pct: 21.0, fg_pct: 47.3 }, shot_tendencies: { inside: 45, mid: 35, three: 20 }, target_minutes: 35, traits: ["Lockdown Defender", "Transition Threat"], foul_tendency: 4, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=SP" },
            "john_stockton": { name: "John Stockton", pos: "PG", tier: "Legend", attributes: { inside_scoring: 75, mid_range: 85, three_point: 82, playmaking: 99, perimeter_defense: 94, interior_defense: 40, rebounding: 50, athleticism: 80, basketball_iq: 97 }, career_stats: { usg_pct: 18.0, fg_pct: 51.5 }, shot_tendencies: { inside: 40, mid: 40, three: 20 }, target_minutes: 34, traits: ["Floor General", "Lockdown Defender"], foul_tendency: 4, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=JS" },
            "isiah_thomas": { name: "Isiah Thomas", pos: "PG", tier: "Legend", attributes: { inside_scoring: 88, mid_range: 86, three_point: 70, playmaking: 95, perimeter_defense: 88, interior_defense: 45, rebounding: 60, athleticism: 91, basketball_iq: 92 }, career_stats: { usg_pct: 26.2, fg_pct: 45.2 }, shot_tendencies: { inside: 50, mid: 40, three: 10 }, target_minutes: 36, traits: ["Ankle Breaker", "Floor General"], foul_tendency: 6, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=IT" },
            "patrick_ewing": { name: "Patrick Ewing", pos: "C", tier: "Legend", attributes: { inside_scoring: 90, mid_range: 92, three_point: 20, playmaking: 60, perimeter_defense: 50, interior_defense: 94, rebounding: 91, athleticism: 86, basketball_iq: 84 }, career_stats: { usg_pct: 29.0, fg_pct: 50.4 }, shot_tendencies: { inside: 50, mid: 50, three: 0 }, target_minutes: 35, traits: ["Rim Protector", "Unstoppable Scorer"], foul_tendency: 7, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=PE" },
            "david_robinson": { name: "David Robinson", pos: "C", tier: "Legend", attributes: { inside_scoring: 93, mid_range: 84, three_point: 50, playmaking: 70, perimeter_defense: 70, interior_defense: 95, rebounding: 92, athleticism: 95, basketball_iq: 91 }, career_stats: { usg_pct: 28.5, fg_pct: 51.8 }, shot_tendencies: { inside: 65, mid: 30, three: 5 }, target_minutes: 34, traits: ["Rim Protector", "Transition Threat"], foul_tendency: 6, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=DR" },
            "clyde_drexler": { name: "Clyde Drexler", pos: "SG", tier: "Legend", attributes: { inside_scoring: 90, mid_range: 80, three_point: 78, playmaking: 85, perimeter_defense: 84, interior_defense: 60, rebounding: 78, athleticism: 94, basketball_iq: 88 }, career_stats: { usg_pct: 26.1, fg_pct: 47.2 }, shot_tendencies: { inside: 50, mid: 30, three: 20 }, target_minutes: 34, traits: ["Transition Threat", "Ankle Breaker"], foul_tendency: 5, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=CD" },
            "george_gervin": { name: "George Gervin", pos: "SG", tier: "Legend", attributes: { inside_scoring: 94, mid_range: 96, three_point: 60, playmaking: 70, perimeter_defense: 70, interior_defense: 50, rebounding: 65, athleticism: 87, basketball_iq: 85 }, career_stats: { usg_pct: 32.8, fg_pct: 51.1 }, shot_tendencies: { inside: 50, mid: 50, three: 0 }, target_minutes: 33, traits: ["Unstoppable Scorer", "Heat Check"], foul_tendency: 7, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=GG" },
            "john_havlicek": { name: "John Havlicek", pos: "SF", tier: "Legend", attributes: { inside_scoring: 86, mid_range: 88, three_point: 50, playmaking: 85, perimeter_defense: 90, interior_defense: 65, rebounding: 78, athleticism: 88, basketball_iq: 93 }, career_stats: { usg_pct: 25.0, fg_pct: 43.9 }, shot_tendencies: { inside: 50, mid: 50, three: 0 }, target_minutes: 36, traits: ["Tireless Motor", "Clutch Performer"], foul_tendency: 4, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=JH" },
            "rick_barry": { name: "Rick Barry", pos: "SF", tier: "Legend", attributes: { inside_scoring: 84, mid_range: 90, three_point: 80, playmaking: 86, perimeter_defense: 82, interior_defense: 60, rebounding: 75, athleticism: 84, basketball_iq: 90 }, career_stats: { usg_pct: 27.5, fg_pct: 44.9 }, shot_tendencies: { inside: 40, mid: 40, three: 20 }, target_minutes: 35, traits: ["Unstoppable Scorer", "Floor General"], foul_tendency: 6, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=RB" },
            "bob_pettit": { name: "Bob Pettit", pos: "PF", tier: "Legend", attributes: { inside_scoring: 92, mid_range: 85, three_point: 30, playmaking: 70, perimeter_defense: 70, interior_defense: 75, rebounding: 96, athleticism: 85, basketball_iq: 88 }, career_stats: { usg_pct: 28.0, fg_pct: 43.6 }, shot_tendencies: { inside: 60, mid: 40, three: 0 }, target_minutes: 36, traits: ["Tireless Motor", "Post Anchor"], foul_tendency: 7, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=BP" },
            "walt_frazier": { name: "Walt Frazier", pos: "PG", tier: "All-Star", attributes: { inside_scoring: 80, mid_range: 88, three_point: 40, playmaking: 88, perimeter_defense: 97, interior_defense: 50, rebounding: 70, athleticism: 86, basketball_iq: 91 }, career_stats: { usg_pct: 24.0, fg_pct: 49.0 }, shot_tendencies: { inside: 40, mid: 60, three: 0 }, target_minutes: 34, traits: ["Lockdown Defender", "Floor General"], foul_tendency: 4, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=WF" },
            "kevin_mchale": { name: "Kevin McHale", pos: "PF", tier: "All-Star", attributes: { inside_scoring: 96, mid_range: 75, three_point: 30, playmaking: 65, perimeter_defense: 60, interior_defense: 90, rebounding: 85, athleticism: 80, basketball_iq: 89 }, career_stats: { usg_pct: 24.1, fg_pct: 55.4 }, shot_tendencies: { inside: 80, mid: 20, three: 0 }, target_minutes: 31, traits: ["Post Anchor", "Unstoppable Scorer"], foul_tendency: 7, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=KM" },
            "dolph_schayes": { name: "Dolph Schayes", pos: "PF", tier: "All-Star", attributes: { inside_scoring: 88, mid_range: 84, three_point: 20, playmaking: 70, perimeter_defense: 65, interior_defense: 70, rebounding: 93, athleticism: 80, basketball_iq: 86 }, career_stats: { usg_pct: 25.0, fg_pct: 38.0 }, shot_tendencies: { inside: 70, mid: 30, three: 0 }, target_minutes: 32, traits: ["Post Anchor", "Tireless Motor"], foul_tendency: 8, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=DS" },
            "elvin_hayes": { name: "Elvin Hayes", pos: "PF", tier: "All-Star", attributes: { inside_scoring: 90, mid_range: 88, three_point: 20, playmaking: 60, perimeter_defense: 60, interior_defense: 85, rebounding: 94, athleticism: 84, basketball_iq: 82 }, career_stats: { usg_pct: 27.2, fg_pct: 45.2 }, shot_tendencies: { inside: 50, mid: 50, three: 0 }, target_minutes: 34, traits: ["Unstoppable Scorer", "Rim Protector"], foul_tendency: 7, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=EH" },
            "dave_cowens": { name: "Dave Cowens", pos: "C", tier: "All-Star", attributes: { inside_scoring: 82, mid_range: 80, three_point: 20, playmaking: 75, perimeter_defense: 70, interior_defense: 80, rebounding: 92, athleticism: 88, basketball_iq: 88 }, career_stats: { usg_pct: 22.0, fg_pct: 46.0 }, shot_tendencies: { inside: 60, mid: 40, three: 0 }, target_minutes: 33, traits: ["Tireless Motor", "Transition Threat"], foul_tendency: 9, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=DC" },
            "wes_unseld": { name: "Wes Unseld", pos: "C", tier: "All-Star", attributes: { inside_scoring: 80, mid_range: 75, three_point: 10, playmaking: 80, perimeter_defense: 60, interior_defense: 85, rebounding: 95, athleticism: 80, basketball_iq: 90 }, career_stats: { usg_pct: 14.0, fg_pct: 50.9 }, shot_tendencies: { inside: 80, mid: 20, three: 0 }, target_minutes: 30, traits: ["Post Anchor", "Floor General"], foul_tendency: 6, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=WU" },
            "robert_parish": { name: "Robert Parish", pos: "C", tier: "All-Star", attributes: { inside_scoring: 88, mid_range: 86, three_point: 10, playmaking: 60, perimeter_defense: 50, interior_defense: 89, rebounding: 88, athleticism: 78, basketball_iq: 85 }, career_stats: { usg_pct: 19.8, fg_pct: 53.7 }, shot_tendencies: { inside: 60, mid: 40, three: 0 }, target_minutes: 28, traits: ["Rim Protector", "Post Anchor"], foul_tendency: 6, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=RP" },
            "bob_cousy": { name: "Bob Cousy", pos: "PG", tier: "All-Star", attributes: { inside_scoring: 78, mid_range: 80, three_point: 30, playmaking: 97, perimeter_defense: 75, interior_defense: 40, rebounding: 60, athleticism: 82, basketball_iq: 94 }, career_stats: { usg_pct: 26.0, fg_pct: 37.5 }, shot_tendencies: { inside: 50, mid: 50, three: 0 }, target_minutes: 32, traits: ["Floor General", "Ankle Breaker"], foul_tendency: 5, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=BC" },
            "james_worthy": { name: "James Worthy", pos: "SF", tier: "All-Star", attributes: { inside_scoring: 92, mid_range: 85, three_point: 50, playmaking: 75, perimeter_defense: 75, interior_defense: 60, rebounding: 70, athleticism: 90, basketball_iq: 86 }, career_stats: { usg_pct: 22.5, fg_pct: 52.1 }, shot_tendencies: { inside: 60, mid: 35, three: 5 }, target_minutes: 32, traits: ["Transition Threat", "Clutch Performer"], foul_tendency: 5, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=JW" },
            "nate_archibald": { name: "Nate Archibald", pos: "PG", tier: "All-Star", attributes: { inside_scoring: 88, mid_range: 82, three_point: 50, playmaking: 94, perimeter_defense: 80, interior_defense: 40, rebounding: 50, athleticism: 90, basketball_iq: 88 }, career_stats: { usg_pct: 25.0, fg_pct: 46.7 }, shot_tendencies: { inside: 60, mid: 35, three: 5 }, target_minutes: 33, traits: ["Floor General", "Ankle Breaker"], foul_tendency: 4, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=NA" },
            "bill_walton": { name: "Bill Walton", pos: "C", tier: "All-Star", attributes: { inside_scoring: 85, mid_range: 75, three_point: 20, playmaking: 88, perimeter_defense: 65, interior_defense: 92, rebounding: 93, athleticism: 82, basketball_iq: 95 }, career_stats: { usg_pct: 20.0, fg_pct: 52.1 }, shot_tendencies: { inside: 70, mid: 30, three: 0 }, target_minutes: 30, traits: ["Floor General", "Rim Protector"], foul_tendency: 7, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=BW" },
            "sam_jones": { name: "Sam Jones", pos: "SG", tier: "All-Star", attributes: { inside_scoring: 82, mid_range: 90, three_point: 40, playmaking: 70, perimeter_defense: 80, interior_defense: 50, rebounding: 65, athleticism: 84, basketball_iq: 88 }, career_stats: { usg_pct: 24.0, fg_pct: 45.6 }, shot_tendencies: { inside: 40, mid: 60, three: 0 }, target_minutes: 32, traits: ["Clutch Performer", "Unstoppable Scorer"], foul_tendency: 5, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=SJ" },
            "george_mikan": { name: "George Mikan", pos: "C", tier: "All-Star", attributes: { inside_scoring: 95, mid_range: 70, three_point: 5, playmaking: 65, perimeter_defense: 40, interior_defense: 88, rebounding: 90, athleticism: 70, basketball_iq: 85 }, career_stats: { usg_pct: 30.0, fg_pct: 40.4 }, shot_tendencies: { inside: 90, mid: 10, three: 0 }, target_minutes: 34, traits: ["Post Anchor", "Rim Protector"], foul_tendency: 9, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=GM" },
            "pete_maravich": { name: "Pete Maravich", pos: "SG", tier: "All-Star", attributes: { inside_scoring: 85, mid_range: 88, three_point: 75, playmaking: 92, perimeter_defense: 70, interior_defense: 40, rebounding: 60, athleticism: 85, basketball_iq: 89 }, career_stats: { usg_pct: 30.5, fg_pct: 44.1 }, shot_tendencies: { inside: 40, mid: 40, three: 20 }, target_minutes: 34, traits: ["Ankle Breaker", "Heat Check"], foul_tendency: 5, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=PM" },
            "dave_debusschere": { name: "Dave DeBusschere", pos: "PF", tier: "All-Star", attributes: { inside_scoring: 80, mid_range: 82, three_point: 30, playmaking: 70, perimeter_defense: 85, interior_defense: 80, rebounding: 90, athleticism: 82, basketball_iq: 88 }, career_stats: { usg_pct: 20.0, fg_pct: 43.2 }, shot_tendencies: { inside: 50, mid: 50, three: 0 }, target_minutes: 32, traits: ["Lockdown Defender", "Tireless Motor"], foul_tendency: 6, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=DD" },
            "jerry_lucas": { name: "Jerry Lucas", pos: "PF", tier: "All-Star", attributes: { inside_scoring: 82, mid_range: 88, three_point: 20, playmaking: 75, perimeter_defense: 70, interior_defense: 75, rebounding: 94, athleticism: 80, basketball_iq: 90 }, career_stats: { usg_pct: 20.0, fg_pct: 49.9 }, shot_tendencies: { inside: 50, mid: 50, three: 0 }, target_minutes: 31, traits: ["Post Anchor", "Floor General"], foul_tendency: 5, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=JL" },
            "earl_monroe": { name: "Earl Monroe", pos: "SG", tier: "All-Star", attributes: { inside_scoring: 88, mid_range: 86, three_point: 40, playmaking: 84, perimeter_defense: 75, interior_defense: 40, rebounding: 55, athleticism: 87, basketball_iq: 88 }, career_stats: { usg_pct: 25.5, fg_pct: 46.4 }, shot_tendencies: { inside: 60, mid: 40, three: 0 }, target_minutes: 32, traits: ["Ankle Breaker", "Unstoppable Scorer"], foul_tendency: 4, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=EM" },
            "bill_sharman": { name: "Bill Sharman", pos: "SG", tier: "All-Star", attributes: { inside_scoring: 75, mid_range: 94, three_point: 30, playmaking: 78, perimeter_defense: 84, interior_defense: 40, rebounding: 60, athleticism: 80, basketball_iq: 87 }, career_stats: { usg_pct: 24.0, fg_pct: 42.6 }, shot_tendencies: { inside: 40, mid: 60, three: 0 }, target_minutes: 32, traits: ["Heat Check", "Clutch Performer"], foul_tendency: 6, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=BS" },
            "lenny_wilkens": { name: "Lenny Wilkens", pos: "PG", tier: "All-Star", attributes: { inside_scoring: 80, mid_range: 85, three_point: 40, playmaking: 90, perimeter_defense: 82, interior_defense: 40, rebounding: 65, athleticism: 83, basketball_iq: 92 }, career_stats: { usg_pct: 22.0, fg_pct: 43.2 }, shot_tendencies: { inside: 50, mid: 50, three: 0 }, target_minutes: 33, traits: ["Floor General", "Lockdown Defender"], foul_tendency: 4, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=LW" },
            "dave_bing": { name: "Dave Bing", pos: "SG", tier: "All-Star", attributes: { inside_scoring: 86, mid_range: 87, three_point: 50, playmaking: 85, perimeter_defense: 78, interior_defense: 45, rebounding: 60, athleticism: 86, basketball_iq: 85 }, career_stats: { usg_pct: 26.0, fg_pct: 44.1 }, shot_tendencies: { inside: 50, mid: 50, three: 0 }, target_minutes: 33, traits: ["Unstoppable Scorer", "Transition Threat"], foul_tendency: 5, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=DB" },
            "hal_greer": { name: "Hal Greer", pos: "SG", tier: "All-Star", attributes: { inside_scoring: 84, mid_range: 90, three_point: 30, playmaking: 80, perimeter_defense: 78, interior_defense: 45, rebounding: 68, athleticism: 83, basketball_iq: 86 }, career_stats: { usg_pct: 24.0, fg_pct: 45.2 }, shot_tendencies: { inside: 40, mid: 60, three: 0 }, target_minutes: 32, traits: ["Heat Check", "Clutch Performer"], foul_tendency: 6, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=HG" },
            "paul_arizin": { name: "Paul Arizin", pos: "SF", tier: "All-Star", attributes: { inside_scoring: 88, mid_range: 91, three_point: 20, playmaking: 65, perimeter_defense: 70, interior_defense: 60, rebounding: 85, athleticism: 82, basketball_iq: 84 }, career_stats: { usg_pct: 28.0, fg_pct: 42.1 }, shot_tendencies: { inside: 50, mid: 50, three: 0 }, target_minutes: 31, traits: ["Unstoppable Scorer", "Tireless Motor"], foul_tendency: 7, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=PA" },
            "billy_cunningham": { name: "Billy Cunningham", pos: "SF", tier: "All-Star", attributes: { inside_scoring: 87, mid_range: 80, three_point: 30, playmaking: 78, perimeter_defense: 75, interior_defense: 65, rebounding: 88, athleticism: 85, basketball_iq: 87 }, career_stats: { usg_pct: 27.0, fg_pct: 44.6 }, shot_tendencies: { inside: 60, mid: 40, three: 0 }, target_minutes: 30, traits: ["Tireless Motor", "Transition Threat"], foul_tendency: 7, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=BC" },
            "nate_thurmond": { name: "Nate Thurmond", pos: "C", tier: "All-Star", attributes: { inside_scoring: 80, mid_range: 70, three_point: 10, playmaking: 65, perimeter_defense: 60, interior_defense: 93, rebounding: 96, athleticism: 84, basketball_iq: 85 }, career_stats: { usg_pct: 18.0, fg_pct: 42.1 }, shot_tendencies: { inside: 70, mid: 30, three: 0 }, target_minutes: 30, traits: ["Rim Protector", "Post Anchor"], foul_tendency: 7, img_url: "https://placehold.co/64x64/FBBF24/1A2238?text=NT" }
        };

        const App = {
            rosters: {
                team1: { starters: {}, bench: {} },
                team2: { starters: {}, bench: {} }
            },
            selectedPlayers: new Set(),
            activeSlot: null,
            series: null,

            init() {
                this.renderHome();
                document.getElementById('app-container').addEventListener('click', (e) => {
                    if (e.target.classList.contains('view-box-score-btn')) {
                        if (this.series) {
                            this.series.viewBoxScore(e.target.dataset.gameIndex);
                        }
                    }
                });
            },

            renderHome() {
                document.getElementById('app-container').innerHTML = `
                    <div class="text-center pt-8 md:pt-16">
                         <div class="logo-shape bg-orange-500 w-48 h-48 mx-auto flex items-center justify-center p-4 shadow-lg mb-4">
                            <div class="text-center">
                                <div class="font-black text-3xl text-gray-900 tracking-tighter leading-none">BASKETBALL</div>
                                <div class="font-black text-3xl text-gray-900 tracking-tighter leading-none">LEGENDS</div>
                            </div>
                        </div>
                        <h1 class="text-3xl font-bold text-gray-200">Simulate your dream basketball matchups.</h1>
                        <div class="mt-12 space-y-6">
                            <div class="flex flex-col md:flex-row justify-center items-center gap-6">
                                <button id="goto-1v1-btn" class="menu-button text-white font-bold py-4 px-10 rounded-lg text-2xl w-64">1v1 Game of 21</button>
                                <button id="goto-series-btn" class="menu-button text-white font-bold py-4 px-10 rounded-lg text-2xl w-64">7-Game Series</button>
                            </div>
                        </div>
                    </div>
                `;
                document.getElementById('goto-1v1-btn').addEventListener('click', () => this.render1v1Setup());
                document.getElementById('goto-series-btn').addEventListener('click', () => this.renderSeriesSetup());
            },
            
            addBackButton(handler) {
                const backButton = document.createElement('button');
                backButton.innerHTML = `&larr;`;
                backButton.className = 'absolute top-4 left-4 bg-gray-700 hover:bg-gray-600 rounded-full w-10 h-10 flex items-center justify-center text-2xl transition';
                backButton.onclick = handler;
                document.getElementById('app-container').prepend(backButton);
            },

            render1v1Setup() {
                 document.getElementById('app-container').innerHTML = `
                    <header class="text-center mb-8">
                        <h1 class="text-4xl md:text-5xl font-bold text-amber-400">1v1: Game of 21</h1>
                    </header>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg max-w-2xl mx-auto">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="p1-select" class="block text-lg font-semibold mb-2">Player 1</label>
                                <select id="p1-select" class="w-full p-3 bg-gray-700 rounded-lg"></select>
                            </div>
                            <div>
                                <label for="p2-select" class="block text-lg font-semibold mb-2">Player 2</label>
                                <select id="p2-select" class="w-full p-3 bg-gray-700 rounded-lg"></select>
                            </div>
                        </div>
                        <div class="text-center mt-6">
                            <button id="start-1v1-btn" class="menu-button text-white font-bold py-3 px-8 rounded-lg text-xl">Simulate Matchup</button>
                        </div>
                    </div>
                `;
                this.addBackButton(() => this.renderHome());
                const p1Select = document.getElementById('p1-select');
                const p2Select = document.getElementById('p2-select');
                Object.entries(players).sort((a,b) => a[1].name.localeCompare(b[1].name)).forEach(([key, player]) => {
                    p1Select.innerHTML += `<option value="${key}">${player.name}</option>`;
                    p2Select.innerHTML += `<option value="${key}">${player.name}</option>`;
                });
                p2Select.selectedIndex = 1;
                document.getElementById('start-1v1-btn').addEventListener('click', () => {
                    const p1Key = p1Select.value;
                    const p2Key = p2Select.value;
                    if (p1Key === p2Key) { alert("Select two different players."); return; }
                    const game = new Game1v1(players[p1Key], players[p2Key]);
                    game.render();
                });
            },

            renderSeriesSetup() {
                this.rosters = { team1: { starters: {}, bench: {} }, team2: { starters: {}, bench: {} } };
                this.selectedPlayers.clear();
                const positions = ["PG", "SG", "SF", "PF", "C"];
                const teamTemplate = (teamNum, teamName) => `
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <input type="text" id="team${teamNum}-name" class="bg-gray-900 text-2xl font-bold text-amber-300 border-none focus:ring-0" value="${teamName}">
                            <button class="menu-button text-sm py-2 px-4 rounded-lg" data-team-num="${teamNum}" id="randomize-team-${teamNum}-btn">Randomize</button>
                        </div>
                        ${['starters', 'bench'].map(type => `
                            <div>
                                <h4 class="text-lg font-semibold mb-2 border-b border-gray-600 pb-1 capitalize">${type}</h4>
                                <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                                    ${positions.map(pos => `
                                        <button class="player-slot h-24 rounded-lg flex flex-col items-center justify-center p-2" 
                                                data-team="team${teamNum}" data-type="${type}" data-pos="${pos}">
                                            <span class="font-bold text-gray-400">${pos}</span>
                                            <span class="text-sm text-gray-500 mt-1">+ Add Player</span>
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;

                document.getElementById('app-container').innerHTML = `
                    <header class="text-center mb-8">
                        <h1 class="text-4xl md:text-5xl font-bold text-amber-400">Build Your Teams</h1>
                    </header>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg space-y-8">
                        ${teamTemplate(1, 'Team 1')}
                        <hr class="border-gray-600"/>
                        ${teamTemplate(2, 'Team 2')}
                    </div>
                    <div class="text-center mt-6">
                        <button id="start-series-btn" class="action-button menu-button font-bold py-3 px-8 rounded-lg text-xl">Start Series</button>
                    </div>
                    <div id="player-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
                        <div class="bg-gray-800 rounded-lg shadow-2xl max-w-md w-full max-h-[80vh] overflow-y-auto">
                            <div class="p-4 border-b border-gray-700 sticky top-0 bg-gray-800 z-10">
                                <h3 id="modal-title" class="text-xl font-bold">Select a Player</h3>
                                <input type="text" id="player-search" class="w-full p-2 mt-2 bg-gray-700 rounded-md" placeholder="Search by name...">
                                <div id="modal-filters" class="flex gap-2 mt-2"></div>
                            </div>
                            <div id="modal-player-list" class="p-4 grid grid-cols-1 sm:grid-cols-2 gap-2"></div>
                             <div class="p-4 border-t border-gray-700 sticky bottom-0 bg-gray-800">
                                <button id="close-modal-btn" class="w-full bg-red-600 hover:bg-red-700 p-2 rounded-lg">Cancel</button>
                            </div>
                        </div>
                    </div>
                `;
                this.addBackButton(() => this.renderHome());
                document.querySelectorAll('.player-slot').forEach(slot => slot.addEventListener('click', () => this.openPlayerModal(slot)));
                document.getElementById('close-modal-btn').addEventListener('click', () => this.closePlayerModal());
                document.getElementById('start-series-btn').addEventListener('click', () => this.startSeries());
                document.getElementById('randomize-team-1-btn').addEventListener('click', () => this.randomizeTeam(1));
                document.getElementById('randomize-team-2-btn').addEventListener('click', () => this.randomizeTeam(2));
            },

            openPlayerModal(slot) {
                this.activeSlot = slot;
                const { pos } = slot.dataset;
                document.getElementById('modal-title').textContent = `Select a ${pos}`;
                
                const searchInput = document.getElementById('player-search');
                searchInput.value = '';
                searchInput.onkeyup = () => this.filterModalPlayers();

                const filters = document.getElementById('modal-filters');
                filters.innerHTML = `
                    <button data-filter="All" class="modal-filter-btn bg-amber-500 p-2 rounded-md text-sm">All</button>
                    <button data-filter="GOAT" class="modal-filter-btn bg-gray-600 p-2 rounded-md text-sm">GOAT</button>
                    <button data-filter="Legend" class="modal-filter-btn bg-gray-600 p-2 rounded-md text-sm">Legend</button>
                    <button data-filter="All-Star" class="modal-filter-btn bg-gray-600 p-2 rounded-md text-sm">All-Star</button>
                `;
                document.querySelectorAll('.modal-filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.modal-filter-btn').forEach(b => b.classList.replace('bg-amber-500', 'bg-gray-600'));
                        e.target.classList.replace('bg-gray-600', 'bg-amber-500');
                        this.filterModalPlayers();
                    });
                });

                this.filterModalPlayers();
                document.getElementById('player-modal').classList.remove('hidden');
            },

            filterModalPlayers() {
                const { pos } = this.activeSlot.dataset;
                const list = document.getElementById('modal-player-list');
                list.innerHTML = '';
                
                const searchTerm = document.getElementById('player-search').value.toLowerCase();
                const activeFilter = document.querySelector('.modal-filter-btn[data-filter].bg-amber-500').dataset.filter;

                const filtered = Object.entries(players).filter(([key, p]) => {
                    const posMatch = p.pos === pos;
                    const nameMatch = p.name.toLowerCase().includes(searchTerm);
                    const tierMatch = activeFilter === 'All' || p.tier === activeFilter;
                    return posMatch && nameMatch && tierMatch;
                });
                
                filtered.forEach(([key, p]) => {
                    const isSelected = this.selectedPlayers.has(key);
                    const btn = document.createElement('button');
                    btn.className = `p-3 rounded-lg text-left ${isSelected ? 'bg-gray-600 text-gray-400 cursor-not-allowed' : 'bg-gray-700 hover:bg-amber-600'}`;
                    btn.innerHTML = `<div class="flex items-center"><img src="${p.img_url}" class="w-8 h-8 rounded-full mr-3"><div class="flex-1"><div>${p.name}</div><div class="text-xs text-gray-400">${p.tier}</div></div></div>`;
                    btn.dataset.key = key;
                    btn.disabled = isSelected;
                    btn.addEventListener('click', () => this.selectPlayer(key));
                    list.appendChild(btn);
                });
            },

            closePlayerModal() {
                document.getElementById('player-modal').classList.add('hidden');
                this.activeSlot = null;
            },

            selectPlayer(playerKey, slot) {
                const targetSlot = slot || this.activeSlot;
                const { team, type, pos } = targetSlot.dataset;
                const oldPlayerKey = this.rosters[team][type][pos];
                if (oldPlayerKey) {
                    this.selectedPlayers.delete(oldPlayerKey);
                }
                this.rosters[team][type][pos] = playerKey;
                this.selectedPlayers.add(playerKey);
                
                targetSlot.innerHTML = `<img src="${players[playerKey].img_url}" class="w-12 h-12 rounded-full mx-auto mb-1"><span class="font-bold text-white text-xs">${players[playerKey].name}</span><span class="text-xs text-gray-400">${pos}</span>`;
                targetSlot.classList.add('filled');
                
                if(!slot) this.closePlayerModal();
            },

            randomizeTeam(teamNum) {
                const team = `team${teamNum}`;
                const positions = ["PG", "SG", "SF", "PF", "C"];
                
                ['starters', 'bench'].forEach(type => {
                    positions.forEach(pos => {
                        const oldPlayerKey = this.rosters[team][type][pos];
                        if (oldPlayerKey) {
                            this.selectedPlayers.delete(oldPlayerKey);
                        }
                        this.rosters[team][type][pos] = null;
                    });
                });

                const availablePlayersByPos = { PG: [], SG: [], SF: [], PF: [], C: [] };
                Object.entries(players).forEach(([key, player]) => {
                    if (!this.selectedPlayers.has(key)) {
                        availablePlayersByPos[player.pos].push(key);
                    }
                });

                ['starters', 'bench'].forEach(type => {
                    positions.forEach(pos => {
                        if (availablePlayersByPos[pos].length > 0) {
                            const randomIndex = Math.floor(Math.random() * availablePlayersByPos[pos].length);
                            const playerKey = availablePlayersByPos[pos].splice(randomIndex, 1)[0];
                            const slot = document.querySelector(`[data-team="${team}"][data-type="${type}"][data-pos="${pos}"]`);
                            this.selectPlayer(playerKey, slot);
                        }
                    });
                });
            },

            startSeries() {
                if (this.selectedPlayers.size < 20) {
                    alert("Please fill all 20 roster spots before starting the series.");
                    return;
                }
                
                const buildRosterArrays = (rosterObj) => ({
                    starters: Object.values(rosterObj.starters).map(key => JSON.parse(JSON.stringify(players[key]))),
                    bench: Object.values(rosterObj.bench).map(key => JSON.parse(JSON.stringify(players[key])))
                });
                
                const team1Name = document.getElementById('team1-name').value || "Team 1";
                const team2Name = document.getElementById('team2-name').value || "Team 2";

                this.series = new Series(buildRosterArrays(this.rosters.team1), buildRosterArrays(this.rosters.team2), team1Name, team2Name);
                this.series.renderSeriesScreen();
            }
        };

        class Game1v1 {
             constructor(p1, p2) {
                this.p1 = p1; this.p2 = p2;
                this.p1_score = 0; this.p2_score = 0;
                this.possession = p1; this.gameOver = false;
            }

            render() {
                document.getElementById('app-container').innerHTML = `
                    <div id="game-1v1-screen">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-8 mb-6 items-center">
                            <div id="p1-card" class="bg-gray-800 p-4 rounded-xl text-center border-2 border-transparent">
                                <h3 class="text-2xl font-bold">${this.p1.name}</h3>
                            </div>
                            <div class="text-center"><p class="text-5xl font-bold"><span id="p1-score">0</span> - <span id="p2-score">0</span></p></div>
                            <div id="p2-card" class="bg-gray-800 p-4 rounded-xl text-center border-2 border-transparent">
                                <h3 class="text-2xl font-bold">${this.p2.name}</h3>
                            </div>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-xl shadow-lg max-w-3xl mx-auto">
                            <h3 class="text-xl font-bold mb-4">Game Log</h3>
                            <ul id="game-log" class="h-64 overflow-y-auto text-gray-300"></ul>
                        </div>
                         <div id="game-over-1v1" class="hidden text-center mt-6"></div>
                    </div>
                `;
                App.addBackButton(() => App.render1v1Setup());
                this.runSimulation();
            }

            runSimulation() {
                if (this.gameOver) return;
                this.playPossession();
                this.updateUI();
                if (!this.gameOver) setTimeout(() => this.runSimulation(), 400);
            }

            playPossession() {
                const offense = this.possession;
                const defense = (this.possession.name === this.p1.name) ? this.p2 : this.p1;
                const weights = offense.attributes;
                const totalWeight = weights.inside_scoring + weights.mid_range + weights.three_point;
                let random = Math.random() * totalWeight;
                let action;
                if (random < weights.inside_scoring) action = 'drive';
                else if (random < weights.inside_scoring + weights.mid_range) action = 'mid_range';
                else action = 'three_point';

                let success = false;
                if (action === 'drive') success = (offense.attributes.inside_scoring + offense.attributes.athleticism)/2 > (defense.attributes.perimeter_defense + defense.attributes.interior_defense)/2 * (1 + Math.random());
                else success = offense.attributes[action] > defense.attributes.perimeter_defense * (1 + Math.random());
                
                if (success) {
                    const points = action === 'three_point' ? 2 : 1;
                    if (offense.name === this.p1.name) this.p1_score += points; else this.p2_score += points;
                    this.log(`SCORES! +${points} for ${offense.name}`, 'score');
                } else {
                    this.log(`MISS! Defensive stop by ${defense.name}.`, 'miss');
                    this.possession = defense;
                }
                this.checkWin();
            }
            
            checkWin() {
                if ((this.p1_score >= 21 || this.p2_score >= 21) && Math.abs(this.p1_score - this.p2_score) >= 2) {
                    this.gameOver = true;
                    const winner = this.p1_score > this.p2_score ? this.p1 : this.p2;
                    const finalScore = `${this.p1_score > this.p2_score ? this.p1_score : this.p2_score} - ${this.p1_score < this.p2_score ? this.p1_score : this.p2_score}`;
                    document.getElementById('game-over-1v1').innerHTML = `
                        <h2 class="text-3xl font-bold text-green-400">${winner.name} wins ${finalScore}!</h2>
                        <button id="play-again-1v1" class="menu-button mt-4 action-button text-white font-bold py-3 px-8 rounded-lg text-xl">New Matchup</button>
                    `;
                    document.getElementById('game-over-1v1').classList.remove('hidden');
                    document.getElementById('play-again-1v1').addEventListener('click', () => App.render1v1Setup());
                }
            }

            log(message, outcome) {
                const li = document.createElement('li');
                li.textContent = message;
                li.className = `mb-2 p-2 rounded-md ${outcome === 'score' ? 'bg-green-500/10 text-green-300' : 'bg-red-500/10 text-red-300'}`;
                document.getElementById('game-log').prepend(li);
            }

            updateUI() {
                document.getElementById('p1-score').textContent = this.p1_score;
                document.getElementById('p2-score').textContent = this.p2_score;
                if (this.possession.name === this.p1.name) {
                    document.getElementById('p1-card').classList.add('border-teal-500');
                    document.getElementById('p2-card').classList.remove('border-teal-500');
                } else {
                    document.getElementById('p2-card').classList.add('border-teal-500');
                    document.getElementById('p1-card').classList.remove('border-teal-500');
                }
            }
        }

        class Series {
            constructor(team1Roster, team2Roster, team1Name, team2Name) {
                this.team1 = { name: team1Name, roster: team1Roster, wins: 0, seriesStats: this.initSeriesStats(team1Roster) };
                this.team2 = { name: team2Name, roster: team2Roster, wins: 0, seriesStats: this.initSeriesStats(team2Roster) };
                this.gameNumber = 1;
                this.seriesLog = [];
                this.gameResults = [];
            }

            initSeriesStats(roster) {
                const stats = {};
                [...roster.starters, ...roster.bench].forEach(p => {
                    stats[p.name] = { pts: 0, reb: 0, ast: 0 };
                });
                return stats;
            }

            renderSeriesScreen() {
                const isSeriesOver = this.team1.wins >= 4 || this.team2.wins >= 4;
                let buttonHtml;

                if (isSeriesOver) {
                    const winner = this.team1.wins > this.team2.wins ? this.team1 : this.team2;
                    const seriesMVP = this.calculateSeriesMVP();
                    this.seriesLog.unshift(`
                        <li class="border-t-4 border-yellow-500 pt-3 mt-3">
                            <p class="font-black text-2xl text-yellow-400">${winner.name} wins the series!</p>
                            <div class="text-lg text-gray-300 mt-2">
                               <strong>Series MVP:</strong> ${seriesMVP.name} 
                               (${(seriesMVP.stats.pts / (this.gameNumber - 1)).toFixed(1)} PPG, 
                                ${(seriesMVP.stats.reb / (this.gameNumber - 1)).toFixed(1)} RPG, 
                                ${(seriesMVP.stats.ast / (this.gameNumber - 1)).toFixed(1)} APG)
                            </div>
                        </li>
                    `);
                    buttonHtml = `<button class="menu-button text-white font-bold py-3 px-8 rounded-lg text-xl" disabled>SERIES OVER</button>`;
                } else {
                    buttonHtml = `
                        <div class="flex flex-col sm:flex-row gap-4 justify-center">
                            <button id="sim-next-game-btn" class="action-button menu-button text-white font-bold py-3 px-8 rounded-lg text-xl">Simulate Game ${this.gameNumber}</button>
                            <button id="sim-full-series-btn" class="menu-button text-white font-bold py-3 px-8 rounded-lg text-xl">Sim Full Series</button>
                        </div>
                    `;
                }

                document.getElementById('app-container').innerHTML = `
                    <header class="text-center mb-6">
                        <h1 class="text-3xl font-bold">Best-of-7 Series</h1>
                        <p class="text-6xl font-black my-2"><span class="text-blue-400">${this.team1.wins}</span> - <span class="text-orange-400">${this.team2.wins}</span></p>
                    </header>
                    <div class="text-center mb-6">${buttonHtml}</div>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg min-h-[200px] max-w-4xl mx-auto">
                        <h3 class="text-xl font-bold mb-4">Series Log</h3>
                        <ul class="text-gray-300 space-y-4">${this.seriesLog.join('')}</ul>
                    </div>
                `;
                
                if (!isSeriesOver) {
                    document.getElementById('sim-next-game-btn').addEventListener('click', () => this.playGame());
                    document.getElementById('sim-full-series-btn').addEventListener('click', () => this.simulateFullSeries());
                }
                
                App.addBackButton(() => App.renderSeriesSetup());
            }
            
            playGame() {
                const game = new SeriesGame(this.team1, this.team2, this);
                game.renderGameScreen();
            }

            simulateFullSeries() {
                 while(this.team1.wins < 4 && this.team2.wins < 4) {
                    const game = new SeriesGame(this.team1, this.team2, this);
                    const result = game.simulateGame();
                    this.endGame(result);
                 }
            }

            endGame(result) {
                if (result.winner.name === this.team1.name) this.team1.wins++;
                else this.team2.wins++;
                
                [...result.team1.onCourt, ...result.team1.bench].forEach(player => {
                    this.team1.seriesStats[player.name].pts += player.stats.pts;
                    this.team1.seriesStats[player.name].reb += player.stats.reb;
                    this.team1.seriesStats[player.name].ast += player.stats.ast;
                });
                [...result.team2.onCourt, ...result.team2.bench].forEach(player => {
                    this.team2.seriesStats[player.name].pts += player.stats.pts;
                    this.team2.seriesStats[player.name].reb += player.stats.reb;
                    this.team2.seriesStats[player.name].ast += player.stats.ast;
                });

                this.seriesLog.unshift(result.log);
                this.gameResults.push(result.gameData);
                this.gameNumber++;
                this.renderSeriesScreen();
            }

            calculateSeriesMVP() {
                const allPlayerObjects = [...this.team1.roster.starters, ...this.team1.roster.bench, ...this.team2.roster.starters, ...this.team2.roster.bench];

                let mvp = null;
                let maxScore = -1;

                allPlayerObjects.forEach(player => {
                    const stats = (this.team1.seriesStats[player.name] || this.team2.seriesStats[player.name]);
                    if (stats) {
                        const mvpScore = stats.pts * 1.0 + stats.reb * 1.2 + stats.ast * 1.5;
                        if (mvpScore > maxScore) {
                            maxScore = mvpScore;
                            mvp = {name: player.name, stats: stats};
                        }
                    }
                });
                return mvp;
            }
            
            viewBoxScore(gameIndex) {
                const gameResult = this.gameResults[gameIndex];
                if (!gameResult) return;

                const boxScoreHtml = (team) => `
                    <div>
                        <h4 class="text-xl font-bold text-teal-300 mb-2">${team.name}</h4>
                        <table class="w-full text-left text-sm">
                            <thead><tr class="border-b border-gray-600"><th class="p-2">Player</th><th class="p-2">MIN</th><th class="p-2">PTS</th><th class="p-2">REB</th><th class="p-2">AST</th></tr></thead>
                            <tbody>
                                ${[...team.onCourt, ...team.bench].sort((a,b) => b.stats.mins - a.stats.mins).map(p => `<tr><td class="p-2">${p.name}</td><td class="p-2">${p.stats.mins}</td><td class="p-2">${p.stats.pts}</td><td class="p-2">${p.stats.reb}</td><td class="p-2">${p.stats.ast}</td></tr>`).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                document.getElementById('app-container').innerHTML = `
                    <header class="text-center mb-6">
                        <h1 class="text-3xl font-bold">Game ${gameResult.gameNumber} Box Score</h1>
                        <p class="text-xl">${gameResult.winner.name} wins ${gameResult.score}</p>
                    </header>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6">
                        ${boxScoreHtml(gameResult.team1)}
                        ${boxScoreHtml(gameResult.team2)}
                    </div>
                `;
                App.addBackButton(() => this.renderSeriesScreen());
            }
        }
        
        class SeriesGame {
            constructor(team1, team2, series) {
                this.team1 = JSON.parse(JSON.stringify(team1));
                this.team2 = JSON.parse(JSON.stringify(team2));
                this.series = series;
                this.gameNumber = series.gameNumber;
                this.score = { q1: {t1:0, t2:0}, q2: {t1:0, t2:0}, q3: {t1:0, t2:0}, q4: {t1:0, t2:0} };
                this.currentQuarter = 1;

                [this.team1, this.team2].forEach(t => {
                    [...t.roster.starters, ...t.roster.bench].forEach(p => {
                        p.stats = { pts: 0, reb: 0, ast: 0, mins: 0 };
                        p.stamina = 100;
                    });
                    t.onCourt = t.roster.starters;
                    t.bench = t.roster.bench;
                });
            }

            simulateGame() {
                while(this.currentQuarter <= 4) {
                    this.runQuarterSimulation();
                    this.handleSubstitutions();
                    this.currentQuarter++;
                }
                return this.finalizeGame();
            }

            renderGameScreen() {
                const t1_total = Object.values(this.score).reduce((s,q)=>s+q.t1,0);
                const t2_total = Object.values(this.score).reduce((s,q)=>s+q.t2,0);
                let buttonHtml;

                if (this.currentQuarter > 4) {
                    buttonHtml = `<button id="finish-game-btn" class="action-button menu-button text-white font-bold py-3 px-8 rounded-lg text-xl">Finalize Game</button>`;
                } else {
                    buttonHtml = `<button id="sim-quarter-btn" class="action-button menu-button text-white font-bold py-3 px-8 rounded-lg text-xl">Simulate Q${this.currentQuarter}</button>`;
                }

                document.getElementById('app-container').innerHTML = `
                    <header class="text-center mb-4">
                        <h1 class="text-3xl font-bold">Game ${this.series.gameNumber}</h1>
                        <p class="text-6xl font-black my-1">${t1_total} - ${t2_total}</p>
                    </header>
                    <div class="bg-gray-800 p-4 rounded-xl shadow-lg max-w-2xl mx-auto">
                        <table class="w-full text-center">
                            <thead><tr class="border-b border-gray-600"><th class="p-2">Team</th><th>Q1</th><th>Q2</th><th>Q3</th><th>Q4</th><th>Total</th></tr></thead>
                            <tbody>
                                <tr><td class="p-2 text-left font-bold text-blue-400">Team 1</td><td>${this.score.q1.t1}</td><td>${this.score.q2.t1}</td><td>${this.score.q3.t1}</td><td>${this.score.q4.t1}</td><td class="font-bold">${t1_total}</td></tr>
                                <tr><td class="p-2 text-left font-bold text-orange-400">Team 2</td><td>${this.score.q1.t2}</td><td>${this.score.q2.t2}</td><td>${this.score.q3.t2}</td><td>${this.score.q4.t2}</td><td class="font-bold">${t2_total}</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="text-center mt-6">${buttonHtml}</div>
                `;

                if (this.currentQuarter > 4) {
                    document.getElementById('finish-game-btn').addEventListener('click', () => this.endGame());
                } else {
                    document.getElementById('sim-quarter-btn').addEventListener('click', () => this.simulateQuarter());
                }
            }

            simulateQuarter() {
                document.getElementById('sim-quarter-btn').disabled = true;
                document.getElementById('sim-quarter-btn').textContent = 'Simulating...';
                setTimeout(() => {
                    this.runQuarterSimulation();
                    this.handleSubstitutions();
                    this.currentQuarter++;
                    this.renderGameScreen();
                }, 500);
            }

            runQuarterSimulation() {
                const possessions = 48; 
                for (let i = 0; i < possessions; i++) {
                    this.runPossession(i % 2 === 0 ? this.team1 : this.team2);
                }
                [this.team1, this.team2].forEach(t => t.onCourt.forEach(p => p.stats.mins += 12));
            }

            handleSubstitutions() {
                [this.team1, this.team2].forEach(team => {
                    team.bench.forEach(p => p.stamina = Math.min(100, p.stamina + 15));
                    
                    for(let i = 0; i < team.onCourt.length; i++) {
                        const tiredPlayer = team.onCourt[i];
                        if (tiredPlayer.stamina < 70 && tiredPlayer.stats.mins < tiredPlayer.target_minutes) {
                            const freshPlayer = team.bench.find(p => p.pos === tiredPlayer.pos && p.stamina > 90);
                            if (freshPlayer) {
                                const freshIndex = team.bench.findIndex(p => p.name === freshPlayer.name);
                                team.onCourt[i] = freshPlayer;
                                team.bench[freshIndex] = tiredPlayer;
                            }
                        }
                    }
                });
            }

            runPossession(offense) {
                const defense = offense.name === this.team1.name ? this.team2 : this.team1;
                
                const totalUsage = offense.onCourt.reduce((sum, p) => sum + p.career_stats.usg_pct, 0);
                let randomUsage = Math.random() * totalUsage;
                let offensivePlayer;
                for(const player of offense.onCourt) {
                    randomUsage -= player.career_stats.usg_pct;
                    if(randomUsage <= 0) {
                        offensivePlayer = player;
                        break;
                    }
                }
                if (!offensivePlayer) offensivePlayer = offense.onCourt[0];

                const defender = defense.onCourt.find(p => p.pos === offensivePlayer.pos) || defense.onCourt[Math.floor(Math.random()*5)];
                
                offensivePlayer.stamina -= 2;
                defender.stamina -= 1;

                const passChance = offensivePlayer.attributes.playmaking - (offensivePlayer.career_stats.usg_pct * 1.5);
                if(Math.random() * 100 < passChance) {
                    const shooter = offense.onCourt.filter(p => p.name !== offensivePlayer.name)[Math.floor(Math.random() * 4)];
                    if (shooter) {
                         this.resolveShot(shooter, offense, defense, offensivePlayer);
                    }
                } else {
                    this.resolveShot(offensivePlayer, offense, defense, null);
                }
            }

            resolveShot(shooter, offense, defense, assister) {
                const defender = defense.onCourt.find(p => p.pos === shooter.pos) || defense.onCourt[Math.floor(Math.random()*5)];
                
                const shotTendencies = shooter.shot_tendencies;
                const totalShotWeight = shotTendencies.inside + shotTendencies.mid + shotTendencies.three;
                let randomShot = Math.random() * totalShotWeight;
                let shotType;

                if (randomShot < shotTendencies.inside) shotType = 'inside_scoring';
                else if (randomShot < shotTendencies.inside + shotTendencies.mid) shotType = 'mid_range';
                else shotType = 'three_point';

                const offRating = shooter.attributes[shotType] * (shooter.stamina / 100);
                const defRating = (shotType === 'inside_scoring' ? defender.attributes.interior_defense : defender.attributes.perimeter_defense) * (defender.stamina / 100);
                
                const baseChance = shooter.career_stats.fg_pct;
                const scoreChance = baseChance + (offRating - defRating) * 0.75;

                if(Math.random() * 100 < scoreChance) {
                    const points = shotType === 'three_point' ? 3 : 2;
                    this.score[`q${this.currentQuarter}`][offense.name === 'Team 1' ? 't1' : 't2'] += points;
                    shooter.stats.pts += points;
                    if(assister) assister.stats.ast++;
                } else {
                    const allPlayers = [...offense.onCourt, ...defense.onCourt];
                    const totalRebChance = allPlayers.reduce((sum, p) => sum + p.attributes.rebounding * (p.stamina/100), 0);
                    let randomReb = Math.random() * totalRebChance;
                    for(const player of allPlayers) {
                        randomReb -= player.attributes.rebounding * (player.stamina/100);
                        if(randomReb <= 0) {
                            player.stats.reb++;
                            break;
                        }
                    }
                }
            }
            
            finalizeGame() {
                const t1_total = Object.values(this.score).reduce((sum, q) => sum + q.t1, 0);
                const t2_total = Object.values(this.score).reduce((sum, q) => sum + q.t2, 0);
                const winner = t1_total >= t2_total ? this.team1 : this.team2;
                const allPlayers = [...this.team1.roster.starters, ...this.team1.roster.bench, ...this.team2.roster.starters, ...this.team2.roster.bench];
                
                const topScorer = [...allPlayers].sort((a,b) => b.stats.pts - a.stats.pts)[0];
                const topRebounder = [...allPlayers].sort((a,b) => b.stats.reb - a.stats.reb)[0];
                const topAssister = [...allPlayers].sort((a,b) => b.stats.ast - a.stats.ast)[0];

                const gameResultForLog = {
                    gameNumber: this.gameNumber,
                    winner: winner,
                    score: `${Math.max(t1_total, t2_total)} - ${Math.min(t1_total, t2_total)}`,
                    team1: this.team1,
                    team2: this.team2
                };
                
                const gameLog = `
                    <li class="border-b border-gray-700 pb-3 mb-3">
                        <div class="flex justify-between items-center">
                            <p class="font-bold text-lg">${winner.name} wins ${Math.max(t1_total, t2_total)} - ${Math.min(t1_total, t2_total)}</p>
                            <button class="view-box-score-btn menu-button text-xs py-1 px-3 rounded" data-game-index="${this.series.gameResults.length}">View Box Score</button>
                        </div>
                        <div class="text-sm text-gray-400 mt-2 grid grid-cols-1 sm:grid-cols-3 gap-2">
                           <span><strong>Top Scorer:</strong> ${topScorer.name} (${topScorer.stats.pts})</span>
                           <span><strong>Top Rebounder:</strong> ${topRebounder.name} (${topRebounder.stats.reb})</span>
                           <span><strong>Top Assister:</strong> ${topAssister.name} (${topAssister.stats.ast})</span>
                        </div>
                    </li>
                `;
                return { winner, log: gameLog, gameData: gameResultForLog, team1: this.team1, team2: this.team2 };
            }

            endGame() {
                const result = this.finalizeGame();
                this.series.endGame(result);
            }
        }

        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>
