
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basketball Legends: The Pantheon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .logo-shape {
            clip-path: polygon(0 15%, 15% 0, 85% 0, 100% 15%, 100% 85%, 85% 100%, 15% 100%, 0 85%);
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #FBBF24;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        .newspaper {
            font-family: 'Times New Roman', Times, serif;
            background-color: #F8F3E3;
            color: #1a1a1a;
            padding: 1rem 2rem 2rem 2rem;
            border: 1px solid #dcdcdc;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .newspaper-header {
            font-family: 'Playfair Display', serif;
            text-align: center;
            border-bottom: 4px double #1a1a1a;
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }
        .newspaper-headline {
            font-family: 'Playfair Display', serif;
            font-weight: 900;
            font-size: 2.5rem; /* 40px */
            line-height: 1.1;
            text-align: center;
        }
        .newspaper-subheadline {
            font-family: 'Georgia', serif;
            font-size: 1.25rem; /* 20px */
            text-align: center;
            margin-top: 0.5rem;
            font-style: italic;
            color: #1a1a1a;
        }
        .newspaper-body {
            text-align: justify;
            line-height: 1.6;
            column-count: 2;
            column-gap: 2rem;
            font-size: 0.95rem;
        }
        .newspaper-divider {
            border: 0;
            border-top: 1px solid #ccc;
            border-bottom: 2px solid #ccc;
            height: 0;
            margin: 1.5rem 0;
        }

        .newspaper-section-title {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            font-size: 1.75rem;
            text-align: center;
            margin-bottom: 1rem;
            border-bottom: 2px solid #1a1a1a;
            padding-bottom: 0.5rem;
        }
        
        .newspaper-mvp-card {
            display: flex;
            align-items: center;
            background-color: #f0ead6; /* Slightly different shade for contrast */
            border: 1px solid #dcdcdc;
            padding: 1rem;
            margin-bottom: 1rem;
            color: #1a1a1a;
        }

        .newspaper-box-score table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Georgia', serif;
            font-size: 0.9rem;
            color: #1a1a1a;
        }

        .newspaper-box-score th, .newspaper-box-score td {
            border: 1px solid #ccc;
            padding: 0.5rem;
            text-align: center;
        }
        
        .newspaper-box-score td:first-child {
            text-align: left;
            font-weight: bold;
        }

        .newspaper-box-score th {
            background-color: #e9e2ce;
            font-weight: bold;
        }

        .newspaper-box-score .team-name {
            font-family: 'Playfair Display', serif;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        @media (max-width: 768px) {
            .newspaper-body {
                column-count: 1;
            }
            .newspaper-headline {
                font-size: 2rem;
            }
            .newspaper-subheadline {
                 font-size: 1.1rem;
            }
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.1.1",
    "react-dom/client": "https://esm.sh/react-dom@^19.1.1/client",
    "react/": "https://esm.sh/react@^19.1.1/",
    "@google/genai": "https://esm.sh/@google/genai@^1.13.0",
    "immer": "https://esm.sh/immer@^10.1.1"
  }
}
</script>
</head>
<body class="bg-[#1A2238] text-gray-200 antialiased">
    <div id="root"></div>
    <script type="module">
        import React, { useState, useCallback, useMemo, useEffect } from 'react';
        import ReactDOM from 'react-dom/client';
        import { GoogleGenAI, Type } from "@google/genai";
        import { produce } from 'immer';

        // --- MERGED TYPES ---
        
        // --- MERGED CONSTANTS ---
        const POSITIONS = ["PG", "SG", "SF", "PF", "C"];

        const toSlug = (name) => name.toLowerCase().replace(/'/g, '').replace(/ /g, '-');

        const players = {
            // GOAT Tier
            "lebron_james": { name: "LeBron James", pos: "SF", tier: "GOAT", attributes: { inside_scoring: 98, mid_range: 85, three_point: 82, playmaking: 99, perimeter_defense: 90, interior_defense: 80, rebounding: 85, athleticism: 97, basketball_iq: 100 }, career_stats: { usg_pct: 31.5, fg_pct: 50.5 }, shot_tendencies: { inside: 55, mid: 20, three: 25 }, target_minutes: 38, traits: ["Floor General", "Transition Threat", "Alpha Dog"], foul_tendency: 3, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("LeBron James")}.png`, era: "Hyper-Modern Era (2010s-2020s)" },
            "michael_jordan": { name: "Michael Jordan", pos: "SG", tier: "GOAT", attributes: { inside_scoring: 98, mid_range: 100, three_point: 75, playmaking: 90, perimeter_defense: 98, interior_defense: 70, rebounding: 75, athleticism: 98, basketball_iq: 97 }, career_stats: { usg_pct: 33.3, fg_pct: 49.7 }, shot_tendencies: { inside: 45, mid: 50, three: 5 }, target_minutes: 38, traits: ["Clutch Performer", "Alpha Dog", "Unstoppable Scorer"], foul_tendency: 4, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Michael Jordan")}.png`, era: "Modern Era (1990s-2000s)" },
            "kareem_abdul_jabbar": { name: "Kareem Abdul-Jabbar", pos: "C", tier: "GOAT", attributes: { inside_scoring: 100, mid_range: 88, three_point: 10, playmaking: 78, perimeter_defense: 60, interior_defense: 96, rebounding: 94, athleticism: 88, basketball_iq: 98 }, career_stats: { usg_pct: 28.5, fg_pct: 55.9 }, shot_tendencies: { inside: 80, mid: 20, three: 0 }, target_minutes: 38, traits: ["Unstoppable Scorer", "Rim Protector"], foul_tendency: 6, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Kareem Abdul-Jabbar")}.png`, era: "Showtime & Three-Point Era (1970s-1980s)" },
            "magic_johnson": { name: "Magic Johnson", pos: "PG", tier: "GOAT", attributes: { inside_scoring: 92, mid_range: 80, three_point: 70, playmaking: 100, perimeter_defense: 80, interior_defense: 60, rebounding: 80, athleticism: 88, basketball_iq: 99 }, career_stats: { usg_pct: 22.8, fg_pct: 52.0 }, shot_tendencies: { inside: 60, mid: 30, three: 10 }, target_minutes: 37, traits: ["Floor General", "Transition Threat"], foul_tendency: 4, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Magic Johnson")}.png`, era: "Showtime & Three-Point Era (1970s-1980s)" },
            "larry_bird": { name: "Larry Bird", pos: "SF", tier: "GOAT", attributes: { inside_scoring: 88, mid_range: 96, three_point: 90, playmaking: 94, perimeter_defense: 80, interior_defense: 72, rebounding: 88, athleticism: 80, basketball_iq: 100 }, career_stats: { usg_pct: 26.5, fg_pct: 49.6 }, shot_tendencies: { inside: 35, mid: 45, three: 20 }, target_minutes: 38, traits: ["Clutch Performer", "Floor General"], foul_tendency: 5, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Larry Bird")}.png`, era: "Showtime & Three-Point Era (1970s-1980s)" },
            "wilt_chamberlain": { name: "Wilt Chamberlain", pos: "C", tier: "GOAT", attributes: { inside_scoring: 100, mid_range: 75, three_point: 5, playmaking: 70, perimeter_defense: 50, interior_defense: 95, rebounding: 100, athleticism: 100, basketball_iq: 85 }, career_stats: { usg_pct: 30.0, fg_pct: 54.0 }, shot_tendencies: { inside: 90, mid: 10, three: 0 }, target_minutes: 40, traits: ["Post Anchor", "Tireless Motor"], foul_tendency: 5, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Wilt Chamberlain")}.png`, era: "Pioneers Era (1940s-1960s)" },
            "bill_russell": { name: "Bill Russell", pos: "C", tier: "GOAT", attributes: { inside_scoring: 75, mid_range: 50, three_point: 5, playmaking: 75, perimeter_defense: 70, interior_defense: 100, rebounding: 99, athleticism: 90, basketball_iq: 100 }, career_stats: { usg_pct: 16.6, fg_pct: 44.0 }, shot_tendencies: { inside: 95, mid: 5, three: 0 }, target_minutes: 36, traits: ["Rim Protector", "Alpha Dog"], foul_tendency: 7, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Bill Russell")}.png`, era: "Pioneers Era (1940s-1960s)" },
            "kobe_bryant": { name: "Kobe Bryant", pos: "SG", tier: "GOAT", attributes: { inside_scoring: 95, mid_range: 98, three_point: 85, playmaking: 86, perimeter_defense: 94, interior_defense: 65, rebounding: 70, athleticism: 95, basketball_iq: 96 }, career_stats: { usg_pct: 31.8, fg_pct: 44.7 }, shot_tendencies: { inside: 35, mid: 45, three: 20 }, target_minutes: 37, traits: ["Clutch Performer", "Alpha Dog", "Unstoppable Scorer"], foul_tendency: 5, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Kobe Bryant")}.png`, era: "Hyper-Modern Era (2010s-2020s)" },
            "tim_duncan": { name: "Tim Duncan", pos: "PF", tier: "GOAT", attributes: { inside_scoring: 96, mid_range: 90, three_point: 30, playmaking: 78, perimeter_defense: 75, interior_defense: 98, rebounding: 95, athleticism: 85, basketball_iq: 98 }, career_stats: { usg_pct: 27.0, fg_pct: 50.6 }, shot_tendencies: { inside: 75, mid: 25, three: 0 }, target_minutes: 36, traits: ["Post Anchor", "Rim Protector", "Floor General"], foul_tendency: 5, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Tim Duncan")}.png`, era: "Modern Era (1990s-2000s)" },
            "stephen_curry": { name: "Stephen Curry", pos: "PG", tier: "Legend", attributes: { inside_scoring: 88, mid_range: 92, three_point: 100, playmaking: 92, perimeter_defense: 80, interior_defense: 40, rebounding: 65, athleticism: 88, basketball_iq: 95 }, career_stats: { usg_pct: 29.0, fg_pct: 47.3 }, shot_tendencies: { inside: 25, mid: 25, three: 50 }, target_minutes: 35, traits: ["Heat Check", "Floor General", "Unstoppable Scorer"], foul_tendency: 3, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Stephen Curry")}.png`, era: "Hyper-Modern Era (2010s-2020s)" },
            "kevin_durant": { name: "Kevin Durant", pos: "SF", tier: "Legend", attributes: { inside_scoring: 94, mid_range: 99, three_point: 92, playmaking: 85, perimeter_defense: 85, interior_defense: 80, rebounding: 80, athleticism: 90, basketball_iq: 94 }, career_stats: { usg_pct: 30.3, fg_pct: 49.3 }, shot_tendencies: { inside: 30, mid: 40, three: 30 }, target_minutes: 37, traits: ["Unstoppable Scorer", "Heat Check", "Clutch Performer"], foul_tendency: 4, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Kevin Durant")}.png`, era: "Hyper-Modern Era (2010s-2020s)" },
            "hakeem_olajuwon": { name: "Hakeem Olajuwon", pos: "C", tier: "Legend", attributes: { inside_scoring: 97, mid_range: 85, three_point: 20, playmaking: 70, perimeter_defense: 75, interior_defense: 99, rebounding: 93, athleticism: 92, basketball_iq: 95 }, career_stats: { usg_pct: 28.9, fg_pct: 51.2 }, shot_tendencies: { inside: 75, mid: 25, three: 0 }, target_minutes: 36, traits: ["Unstoppable Scorer", "Rim Protector"], foul_tendency: 8, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Hakeem Olajuwon")}.png`, era: "Modern Era (1990s-2000s)" },
            "shaquille_oneal": { name: "Shaquille O'Neal", pos: "C", tier: "Legend", attributes: { inside_scoring: 100, mid_range: 25, three_point: 5, playmaking: 65, perimeter_defense: 30, interior_defense: 92, rebounding: 94, athleticism: 95, basketball_iq: 80 }, career_stats: { usg_pct: 29.5, fg_pct: 58.2 }, shot_tendencies: { inside: 99, mid: 1, three: 0 }, target_minutes: 35, traits: ["Post Anchor", "Rim Protector"], foul_tendency: 9, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Shaquille O'Neal")}.png`, era: "Modern Era (1990s-2000s)" },
            "oscar_robertson": { name: "Oscar Robertson", pos: "PG", tier: "Legend", attributes: { inside_scoring: 90, mid_range: 92, three_point: 50, playmaking: 98, perimeter_defense: 85, interior_defense: 60, rebounding: 82, athleticism: 85, basketball_iq: 96 }, career_stats: { usg_pct: 26.0, fg_pct: 48.5 }, shot_tendencies: { inside: 50, mid: 50, three: 0 }, target_minutes: 38, traits: ["Floor General", "Tireless Motor"], foul_tendency: 5, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Oscar Robertson")}.png`, era: "Pioneers Era (1940s-1960s)" },
            "dirk_nowitzki": { name: "Dirk Nowitzki", pos: "PF", tier: "Legend", attributes: { inside_scoring: 85, mid_range: 98, three_point: 88, playmaking: 75, perimeter_defense: 60, interior_defense: 70, rebounding: 85, athleticism: 78, basketball_iq: 95 }, career_stats: { usg_pct: 28.0, fg_pct: 47.1 }, shot_tendencies: { inside: 25, mid: 50, three: 25 }, target_minutes: 34, traits: ["Unstoppable Scorer", "Clutch Performer"], foul_tendency: 4, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Dirk Nowitzki")}.png`, era: "Hyper-Modern Era (2010s-2020s)" },
            "kevin_garnett": { name: "Kevin Garnett", pos: "PF", tier: "Legend", attributes: { inside_scoring: 90, mid_range: 94, three_point: 60, playmaking: 82, perimeter_defense: 95, interior_defense: 94, rebounding: 92, athleticism: 90, basketball_iq: 93 }, career_stats: { usg_pct: 26.3, fg_pct: 49.7 }, shot_tendencies: { inside: 40, mid: 55, three: 5 }, target_minutes: 36, traits: ["Alpha Dog", "Rim Protector", "Tireless Motor"], foul_tendency: 6, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Kevin Garnett")}.png`, era: "Modern Era (1990s-2000s)" },
            "karl_malone": { name: "Karl Malone", pos: "PF", tier: "Legend", attributes: { inside_scoring: 95, mid_range: 88, three_point: 40, playmaking: 70, perimeter_defense: 78, interior_defense: 75, rebounding: 90, athleticism: 94, basketball_iq: 85 }, career_stats: { usg_pct: 28.7, fg_pct: 51.6 }, shot_tendencies: { inside: 60, mid: 40, three: 0 }, target_minutes: 37, traits: ["Post Anchor", "Transition Threat"], foul_tendency: 8, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Karl Malone")}.png`, era: "Modern Era (1990s-2000s)" },
            "julius_erving": { name: "Julius Erving", pos: "SF", tier: "Legend", attributes: { inside_scoring: 97, mid_range: 80, three_point: 65, playmaking: 80, perimeter_defense: 85, interior_defense: 75, rebounding: 85, athleticism: 96, basketball_iq: 90 }, career_stats: { usg_pct: 28.8, fg_pct: 50.6 }, shot_tendencies: { inside: 70, mid: 25, three: 5 }, target_minutes: 36, traits: ["Transition Threat", "Unstoppable Scorer"], foul_tendency: 6, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Julius Erving")}.png`, era: "Showtime & Three-Point Era (1970s-1980s)" },
            "moses_malone": { name: "Moses Malone", pos: "C", tier: "Legend", attributes: { inside_scoring: 94, mid_range: 70, three_point: 20, playmaking: 60, perimeter_defense: 60, interior_defense: 88, rebounding: 98, athleticism: 85, basketball_iq: 88 }, career_stats: { usg_pct: 26.1, fg_pct: 49.1 }, shot_tendencies: { inside: 85, mid: 15, three: 0 }, target_minutes: 34, traits: ["Post Anchor", "Tireless Motor"], foul_tendency: 7, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Moses Malone")}.png`, era: "Showtime & Three-Point Era (1970s-1980s)" },
            "jerry_west": { name: "Jerry West", pos: "SG", tier: "Legend", attributes: { inside_scoring: 85, mid_range: 95, three_point: 80, playmaking: 90, perimeter_defense: 92, interior_defense: 60, rebounding: 70, athleticism: 88, basketball_iq: 94 }, career_stats: { usg_pct: 30.0, fg_pct: 47.4 }, shot_tendencies: { inside: 40, mid: 60, three: 0 }, target_minutes: 37, traits: ["Clutch Performer", "Unstoppable Scorer"], foul_tendency: 5, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Jerry West")}.png`, era: "Pioneers Era (1940s-1960s)" },
            "elgin_baylor": { name: "Elgin Baylor", pos: "SF", tier: "Legend", attributes: { inside_scoring: 96, mid_range: 90, three_point: 40, playmaking: 80, perimeter_defense: 78, interior_defense: 65, rebounding: 92, athleticism: 93, basketball_iq: 90 }, career_stats: { usg_pct: 29.0, fg_pct: 43.1 }, shot_tendencies: { inside: 60, mid: 40, three: 0 }, target_minutes: 36, traits: ["Unstoppable Scorer", "Tireless Motor"], foul_tendency: 6, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Elgin Baylor")}.png`, era: "Pioneers Era (1940s-1960s)" },
            "dwyane_wade": { name: "Dwyane Wade", pos: "SG", tier: "Legend", attributes: { inside_scoring: 96, mid_range: 84, three_point: 75, playmaking: 88, perimeter_defense: 90, interior_defense: 75, rebounding: 68, athleticism: 94, basketball_iq: 92 }, career_stats: { usg_pct: 32.0, fg_pct: 48.0 }, shot_tendencies: { inside: 55, mid: 35, three: 10 }, target_minutes: 35, traits: ["Clutch Performer", "Transition Threat", "Ankle Breaker"], foul_tendency: 5, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Dwyane Wade")}.png`, era: "Hyper-Modern Era (2010s-2020s)" },
            "giannis_antetokounmpo": { name: "Giannis Antetokounmpo", pos: "PF", tier: "Legend", attributes: { inside_scoring: 99, mid_range: 72, three_point: 70, playmaking: 85, perimeter_defense: 92, interior_defense: 90, rebounding: 93, athleticism: 100, basketball_iq: 90 }, career_stats: { usg_pct: 32.5, fg_pct: 53.5 }, shot_tendencies: { inside: 75, mid: 15, three: 10 }, target_minutes: 34, traits: ["Transition Threat", "Unstoppable Scorer", "Rim Protector"], foul_tendency: 7, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Giannis Antetokounmpo")}.png`, era: "Hyper-Modern Era (2010s-2020s)" },
            "scottie_pippen": { name: "Scottie Pippen", pos: "SF", tier: "Legend", attributes: { inside_scoring: 85, mid_range: 82, three_point: 75, playmaking: 88, perimeter_defense: 100, interior_defense: 80, rebounding: 80, athleticism: 92, basketball_iq: 93 }, career_stats: { usg_pct: 21.0, fg_pct: 47.3 }, shot_tendencies: { inside: 45, mid: 35, three: 20 }, target_minutes: 35, traits: ["Lockdown Defender", "Transition Threat"], foul_tendency: 4, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Scottie Pippen")}.png`, era: "Modern Era (1990s-2000s)" },
            "charles_barkley": { name: "Charles Barkley", pos: "PF", tier: "Legend", attributes: { inside_scoring: 92, mid_range: 80, three_point: 70, playmaking: 75, perimeter_defense: 70, interior_defense: 65, rebounding: 95, athleticism: 90, basketball_iq: 87 }, career_stats: { usg_pct: 26.6, fg_pct: 54.1 }, shot_tendencies: { inside: 65, mid: 25, three: 10 }, target_minutes: 35, traits: ["Tireless Motor", "Post Anchor"], foul_tendency: 8, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Charles Barkley")}.png`, era: "Modern Era (1990s-2000s)" },
            "john_stockton": { name: "John Stockton", pos: "PG", tier: "Legend", attributes: { inside_scoring: 75, mid_range: 85, three_point: 82, playmaking: 99, perimeter_defense: 94, interior_defense: 40, rebounding: 50, athleticism: 80, basketball_iq: 97 }, career_stats: { usg_pct: 18.0, fg_pct: 51.5 }, shot_tendencies: { inside: 40, mid: 40, three: 20 }, target_minutes: 34, traits: ["Floor General", "Lockdown Defender"], foul_tendency: 4, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("John Stockton")}.png`, era: "Modern Era (1990s-2000s)" },
            "allen_iverson": { name: "Allen Iverson", pos: "SG", tier: "Legend", attributes: { inside_scoring: 94, mid_range: 88, three_point: 78, playmaking: 88, perimeter_defense: 88, interior_defense: 45, rebounding: 60, athleticism: 98, basketball_iq: 85 }, career_stats: { usg_pct: 31.8, fg_pct: 42.5 }, shot_tendencies: { inside: 50, mid: 35, three: 15 }, target_minutes: 38, traits: ["Ankle Breaker", "Unstoppable Scorer", "Tireless Motor"], foul_tendency: 4, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Allen Iverson")}.png`, era: "Modern Era (1990s-2000s)" },
            "isiah_thomas": { name: "Isiah Thomas", pos: "PG", tier: "Legend", attributes: { inside_scoring: 88, mid_range: 86, three_point: 70, playmaking: 95, perimeter_defense: 88, interior_defense: 45, rebounding: 60, athleticism: 91, basketball_iq: 92 }, career_stats: { usg_pct: 26.2, fg_pct: 45.2 }, shot_tendencies: { inside: 50, mid: 40, three: 10 }, target_minutes: 36, traits: ["Ankle Breaker", "Floor General"], foul_tendency: 6, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Isiah Thomas")}.png`, era: "Showtime & Three-Point Era (1970s-1980s)" },
            "kawhi_leonard": { name: "Kawhi Leonard", pos: "SF", tier: "Legend", attributes: { inside_scoring: 90, mid_range: 95, three_point: 85, playmaking: 80, perimeter_defense: 100, interior_defense: 75, rebounding: 80, athleticism: 92, basketball_iq: 94 }, career_stats: { usg_pct: 27.0, fg_pct: 49.3 }, shot_tendencies: { inside: 30, mid: 50, three: 20 }, target_minutes: 34, traits: ["Lockdown Defender", "Clutch Performer", "Alpha Dog"], foul_tendency: 3, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Kawhi Leonard")}.png`, era: "Hyper-Modern Era (2010s-2020s)" },
            "patrick_ewing": { name: "Patrick Ewing", pos: "C", tier: "Legend", attributes: { inside_scoring: 90, mid_range: 92, three_point: 20, playmaking: 60, perimeter_defense: 50, interior_defense: 94, rebounding: 91, athleticism: 86, basketball_iq: 84 }, career_stats: { usg_pct: 29.0, fg_pct: 50.4 }, shot_tendencies: { inside: 50, mid: 50, three: 0 }, target_minutes: 35, traits: ["Rim Protector", "Unstoppable Scorer"], foul_tendency: 7, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Patrick Ewing")}.png`, era: "Modern Era (1990s-2000s)" },
            "david_robinson": { name: "David Robinson", pos: "C", tier: "Legend", attributes: { inside_scoring: 93, mid_range: 84, three_point: 50, playmaking: 70, perimeter_defense: 70, interior_defense: 95, rebounding: 92, athleticism: 95, basketball_iq: 91 }, career_stats: { usg_pct: 28.5, fg_pct: 51.8 }, shot_tendencies: { inside: 65, mid: 30, three: 5 }, target_minutes: 34, traits: ["Rim Protector", "Transition Threat"], foul_tendency: 6, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("David Robinson")}.png`, era: "Modern Era (1990s-2000s)" },
            "clyde_drexler": { name: "Clyde Drexler", pos: "SG", tier: "Legend", attributes: { inside_scoring: 90, mid_range: 80, three_point: 78, playmaking: 85, perimeter_defense: 84, interior_defense: 60, rebounding: 78, athleticism: 94, basketball_iq: 88 }, career_stats: { usg_pct: 26.1, fg_pct: 47.2 }, shot_tendencies: { inside: 50, mid: 30, three: 20 }, target_minutes: 34, traits: ["Transition Threat", "Ankle Breaker"], foul_tendency: 5, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Clyde Drexler")}.png`, era: "Modern Era (1990s-2000s)" },
            "george_gervin": { name: "George Gervin", pos: "SG", tier: "Legend", attributes: { inside_scoring: 94, mid_range: 96, three_point: 60, playmaking: 70, perimeter_defense: 70, interior_defense: 50, rebounding: 65, athleticism: 87, basketball_iq: 85 }, career_stats: { usg_pct: 32.8, fg_pct: 51.1 }, shot_tendencies: { inside: 50, mid: 50, three: 0 }, target_minutes: 33, traits: ["Unstoppable Scorer", "Heat Check"], foul_tendency: 7, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("George Gervin")}.png`, era: "Showtime & Three-Point Era (1970s-1980s)" },
            "john_havlicek": { name: "John Havlicek", pos: "SF", tier: "Legend", attributes: { inside_scoring: 86, mid_range: 88, three_point: 50, playmaking: 85, perimeter_defense: 90, interior_defense: 65, rebounding: 78, athleticism: 88, basketball_iq: 93 }, career_stats: { usg_pct: 25.0, fg_pct: 43.9 }, shot_tendencies: { inside: 50, mid: 50, three: 0 }, target_minutes: 36, traits: ["Tireless Motor", "Clutch Performer"], foul_tendency: 4, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("John Havlicek")}.png`, era: "Pioneers Era (1940s-1960s)" },
            "rick_barry": { name: "Rick Barry", pos: "SF", tier: "Legend", attributes: { inside_scoring: 84, mid_range: 90, three_point: 80, playmaking: 86, perimeter_defense: 82, interior_defense: 60, rebounding: 75, athleticism: 84, basketball_iq: 90 }, career_stats: { usg_pct: 27.5, fg_pct: 44.9 }, shot_tendencies: { inside: 40, mid: 40, three: 20 }, target_minutes: 35, traits: ["Unstoppable Scorer", "Floor General"], foul_tendency: 6, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Rick Barry")}.png`, era: "Showtime & Three-Point Era (1970s-1980s)" },
            "bob_pettit": { name: "Bob Pettit", pos: "PF", tier: "Legend", attributes: { inside_scoring: 92, mid_range: 85, three_point: 30, playmaking: 70, perimeter_defense: 70, interior_defense: 75, rebounding: 96, athleticism: 85, basketball_iq: 88 }, career_stats: { usg_pct: 28.0, fg_pct: 43.6 }, shot_tendencies: { inside: 60, mid: 40, three: 0 }, target_minutes: 36, traits: ["Tireless Motor", "Post Anchor"], foul_tendency: 7, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Bob Pettit")}.png`, era: "Pioneers Era (1940s-1960s)" },
            "dominique_wilkins": { name: "Dominique Wilkins", pos: "SF", tier: "Legend", attributes: { inside_scoring: 95, mid_range: 88, three_point: 72, playmaking: 70, perimeter_defense: 70, interior_defense: 60, rebounding: 78, athleticism: 98, basketball_iq: 82 }, career_stats: { usg_pct: 30.3, fg_pct: 46.1 }, shot_tendencies: { inside: 60, mid: 30, three: 10 }, target_minutes: 35, traits: ["Transition Threat", "Unstoppable Scorer"], foul_tendency: 5, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Dominique Wilkins")}.png`, era: "Showtime & Three-Point Era (1970s-1980s)" },
            "chris_paul": { name: "Chris Paul", pos: "PG", tier: "All-Star", attributes: { inside_scoring: 80, mid_range: 90, three_point: 84, playmaking: 98, perimeter_defense: 92, interior_defense: 40, rebounding: 60, athleticism: 86, basketball_iq: 98 }, career_stats: { usg_pct: 24.0, fg_pct: 47.2 }, shot_tendencies: { inside: 30, mid: 50, three: 20 }, target_minutes: 33, traits: ["Floor General", "Clutch Performer"], foul_tendency: 4, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Chris Paul")}.png`, era: "Hyper-Modern Era (2010s-2020s)" },
            "james_harden": { name: "James Harden", pos: "SG", tier: "All-Star", attributes: { inside_scoring: 92, mid_range: 80, three_point: 90, playmaking: 94, perimeter_defense: 78, interior_defense: 60, rebounding: 75, athleticism: 88, basketball_iq: 91 }, career_stats: { usg_pct: 30.0, fg_pct: 44.2 }, shot_tendencies: { inside: 40, mid: 15, three: 45 }, target_minutes: 36, traits: ["Unstoppable Scorer", "Ankle Breaker", "Floor General"], foul_tendency: 5, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("James Harden")}.png`, era: "Hyper-Modern Era (2010s-2020s)" },
            "russell_westbrook": { name: "Russell Westbrook", pos: "PG", tier: "All-Star", attributes: { inside_scoring: 92, mid_range: 78, three_point: 75, playmaking: 93, perimeter_defense: 84, interior_defense: 55, rebounding: 85, athleticism: 99, basketball_iq: 86 }, career_stats: { usg_pct: 32.5, fg_pct: 43.7 }, shot_tendencies: { inside: 55, mid: 25, three: 20 }, target_minutes: 35, traits: ["Transition Threat", "Tireless Motor", "Ankle Breaker"], foul_tendency: 6, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Russell Westbrook")}.png`, era: "Hyper-Modern Era (2010s-2020s)" },
            "gary_payton": { name: "Gary Payton", pos: "PG", tier: "All-Star", attributes: { inside_scoring: 82, mid_range: 86, three_point: 75, playmaking: 90, perimeter_defense: 99, interior_defense: 50, rebounding: 65, athleticism: 88, basketball_iq: 92 }, career_stats: { usg_pct: 25.0, fg_pct: 46.6 }, shot_tendencies: { inside: 45, mid: 40, three: 15 }, target_minutes: 36, traits: ["Lockdown Defender", "Floor General"], foul_tendency: 5, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Gary Payton")}.png`, era: "Modern Era (1990s-2000s)" },
            "jason_kidd": { name: "Jason Kidd", pos: "PG", tier: "All-Star", attributes: { inside_scoring: 78, mid_range: 75, three_point: 80, playmaking: 97, perimeter_defense: 93, interior_defense: 50, rebounding: 78, athleticism: 85, basketball_iq: 96 }, career_stats: { usg_pct: 19.0, fg_pct: 40.0 }, shot_tendencies: { inside: 40, mid: 25, three: 35 }, target_minutes: 36, traits: ["Floor General", "Lockdown Defender", "Transition Threat"], foul_tendency: 4, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Jason Kidd")}.png`, era: "Modern Era (1990s-2000s)" },
            "steve_nash": { name: "Steve Nash", pos: "PG", tier: "All-Star", attributes: { inside_scoring: 75, mid_range: 88, three_point: 91, playmaking: 98, perimeter_defense: 65, interior_defense: 30, rebounding: 50, athleticism: 84, basketball_iq: 97 }, career_stats: { usg_pct: 20.0, fg_pct: 49.0 }, shot_tendencies: { inside: 25, mid: 40, three: 35 }, target_minutes: 32, traits: ["Floor General", "Heat Check"], foul_tendency: 3, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Steve Nash")}.png`, era: "Modern Era (1990s-2000s)" },
            "ray_allen": { name: "Ray Allen", pos: "SG", tier: "All-Star", attributes: { inside_scoring: 82, mid_range: 90, three_point: 98, playmaking: 80, perimeter_defense: 80, interior_defense: 40, rebounding: 60, athleticism: 86, basketball_iq: 90 }, career_stats: { usg_pct: 24.0, fg_pct: 45.2 }, shot_tendencies: { inside: 20, mid: 40, three: 40 }, target_minutes: 34, traits: ["Heat Check", "Clutch Performer", "Tireless Motor"], foul_tendency: 4, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Ray Allen")}.png`, era: "Modern Era (1990s-2000s)" },
            "reggie_miller": { name: "Reggie Miller", pos: "SG", tier: "All-Star", attributes: { inside_scoring: 75, mid_range: 88, three_point: 97, playmaking: 75, perimeter_defense: 78, interior_defense: 35, rebounding: 50, athleticism: 84, basketball_iq: 91 }, career_stats: { usg_pct: 22.0, fg_pct: 47.1 }, shot_tendencies: { inside: 15, mid: 40, three: 45 }, target_minutes: 34, traits: ["Clutch Performer", "Heat Check", "Alpha Dog"], foul_tendency: 4, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Reggie Miller")}.png`, era: "Modern Era (1990s-2000s)" },
            "paul_pierce": { name: "Paul Pierce", pos: "SF", tier: "All-Star", attributes: { inside_scoring: 88, mid_range: 90, three_point: 85, playmaking: 82, perimeter_defense: 80, interior_defense: 60, rebounding: 75, athleticism: 82, basketball_iq: 92 }, career_stats: { usg_pct: 26.5, fg_pct: 44.5 }, shot_tendencies: { inside: 35, mid: 40, three: 25 }, target_minutes: 34, traits: ["Clutch Performer", "Unstoppable Scorer"], foul_tendency: 5, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Paul Pierce")}.png`, era: "Modern Era (1990s-2000s)" },
            "carmelo_anthony": { name: "Carmelo Anthony", pos: "SF", tier: "All-Star", attributes: { inside_scoring: 89, mid_range: 95, three_point: 84, playmaking: 75, perimeter_defense: 68, interior_defense: 62, rebounding: 78, athleticism: 84, basketball_iq: 85 }, career_stats: { usg_pct: 29.0, fg_pct: 44.7 }, shot_tendencies: { inside: 30, mid: 45, three: 25 }, target_minutes: 35, traits: ["Unstoppable Scorer", "Clutch Performer"], foul_tendency: 5, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Carmelo Anthony")}.png`, era: "Hyper-Modern Era (2010s-2020s)" },
            "anthony_davis": { name: "Anthony Davis", pos: "PF", tier: "All-Star", attributes: { inside_scoring: 94, mid_range: 86, three_point: 78, playmaking: 72, perimeter_defense: 88, interior_defense: 95, rebounding: 91, athleticism: 91, basketball_iq: 88 }, career_stats: { usg_pct: 27.5, fg_pct: 51.5 }, shot_tendencies: { inside: 55, mid: 30, three: 15 }, target_minutes: 35, traits: ["Rim Protector", "Unstoppable Scorer", "Transition Threat"], foul_tendency: 6, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Anthony Davis")}.png`, era: "Hyper-Modern Era (2010s-2020s)" },
            "damian_lillard": { name: "Damian Lillard", pos: "PG", tier: "All-Star", attributes: { inside_scoring: 86, mid_range: 88, three_point: 94, playmaking: 90, perimeter_defense: 75, interior_defense: 40, rebounding: 60, athleticism: 89, basketball_iq: 92 }, career_stats: { usg_pct: 28.5, fg_pct: 43.9 }, shot_tendencies: { inside: 30, mid: 25, three: 45 }, target_minutes: 36, traits: ["Clutch Performer", "Heat Check", "Alpha Dog"], foul_tendency: 3, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Damian Lillard")}.png`, era: "Hyper-Modern Era (2010s-2020s)" },
            "dennis_rodman": { name: "Dennis Rodman", pos: "PF", tier: "All-Star", attributes: { inside_scoring: 60, mid_range: 40, three_point: 20, playmaking: 60, perimeter_defense: 92, interior_defense: 90, rebounding: 100, athleticism: 88, basketball_iq: 85 }, career_stats: { usg_pct: 8.0, fg_pct: 52.1 }, shot_tendencies: { inside: 90, mid: 10, three: 0 }, target_minutes: 30, traits: ["Lockdown Defender", "Tireless Motor", "Post Anchor"], foul_tendency: 8, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Dennis Rodman")}.png`, era: "Modern Era (1990s-2000s)" },
            "walt_frazier": { name: "Walt Frazier", pos: "PG", tier: "All-Star", attributes: { inside_scoring: 80, mid_range: 88, three_point: 40, playmaking: 88, perimeter_defense: 97, interior_defense: 50, rebounding: 70, athleticism: 86, basketball_iq: 91 }, career_stats: { usg_pct: 24.0, fg_pct: 49.0 }, shot_tendencies: { inside: 40, mid: 60, three: 0 }, target_minutes: 34, traits: ["Lockdown Defender", "Floor General"], foul_tendency: 4, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Walt Frazier")}.png`, era: "Showtime & Three-Point Era (1970s-1980s)" },
            "kevin_mchale": { name: "Kevin McHale", pos: "PF", tier: "All-Star", attributes: { inside_scoring: 96, mid_range: 75, three_point: 30, playmaking: 65, perimeter_defense: 60, interior_defense: 90, rebounding: 85, athleticism: 80, basketball_iq: 89 }, career_stats: { usg_pct: 24.1, fg_pct: 55.4 }, shot_tendencies: { inside: 80, mid: 20, three: 0 }, target_minutes: 31, traits: ["Post Anchor", "Unstoppable Scorer"], foul_tendency: 7, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Kevin McHale")}.png`, era: "Showtime & Three-Point Era (1970s-1980s)" },
            "elvin_hayes": { name: "Elvin Hayes", pos: "PF", tier: "All-Star", attributes: { inside_scoring: 90, mid_range: 88, three_point: 20, playmaking: 60, perimeter_defense: 60, interior_defense: 85, rebounding: 94, athleticism: 84, basketball_iq: 82 }, career_stats: { usg_pct: 27.2, fg_pct: 45.2 }, shot_tendencies: { inside: 50, mid: 50, three: 0 }, target_minutes: 34, traits: ["Unstoppable Scorer", "Rim Protector"], foul_tendency: 7, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Elvin Hayes")}.png`, era: "Showtime & Three-Point Era (1970s-1980s)" },
            "robert_parish": { name: "Robert Parish", pos: "C", tier: "All-Star", attributes: { inside_scoring: 88, mid_range: 86, three_point: 10, playmaking: 60, perimeter_defense: 50, interior_defense: 89, rebounding: 88, athleticism: 78, basketball_iq: 85 }, career_stats: { usg_pct: 19.8, fg_pct: 53.7 }, shot_tendencies: { inside: 60, mid: 40, three: 0 }, target_minutes: 28, traits: ["Rim Protector", "Post Anchor"], foul_tendency: 6, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Robert Parish")}.png`, era: "Modern Era (1990s-2000s)" },
            "james_worthy": { name: "James Worthy", pos: "SF", tier: "All-Star", attributes: { inside_scoring: 92, mid_range: 85, three_point: 50, playmaking: 75, perimeter_defense: 75, interior_defense: 60, rebounding: 70, athleticism: 90, basketball_iq: 86 }, career_stats: { usg_pct: 22.5, fg_pct: 52.1 }, shot_tendencies: { inside: 60, mid: 35, three: 5 }, target_minutes: 32, traits: ["Transition Threat", "Clutch Performer"], foul_tendency: 5, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("James Worthy")}.png`, era: "Showtime & Three-Point Era (1970s-1980s)" },
            "bob_cousy": { name: "Bob Cousy", pos: "PG", tier: "All-Star", attributes: { inside_scoring: 78, mid_range: 80, three_point: 30, playmaking: 97, perimeter_defense: 75, interior_defense: 40, rebounding: 60, athleticism: 82, basketball_iq: 94 }, career_stats: { usg_pct: 26.0, fg_pct: 37.5 }, shot_tendencies: { inside: 50, mid: 50, three: 0 }, target_minutes: 32, traits: ["Floor General", "Ankle Breaker"], foul_tendency: 5, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Bob Cousy")}.png`, era: "Pioneers Era (1940s-1960s)" },
            "nate_archibald": { name: "Nate Archibald", pos: "PG", tier: "All-Star", attributes: { inside_scoring: 88, mid_range: 82, three_point: 50, playmaking: 94, perimeter_defense: 80, interior_defense: 40, rebounding: 50, athleticism: 90, basketball_iq: 88 }, career_stats: { usg_pct: 25.0, fg_pct: 46.7 }, shot_tendencies: { inside: 60, mid: 35, three: 5 }, target_minutes: 33, traits: ["Floor General", "Ankle Breaker"], foul_tendency: 4, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Nate Archibald")}.png`, era: "Showtime & Three-Point Era (1970s-1980s)" },
            "bill_walton": { name: "Bill Walton", pos: "C", tier: "All-Star", attributes: { inside_scoring: 85, mid_range: 75, three_point: 20, playmaking: 88, perimeter_defense: 65, interior_defense: 92, rebounding: 93, athleticism: 82, basketball_iq: 95 }, career_stats: { usg_pct: 20.0, fg_pct: 52.1 }, shot_tendencies: { inside: 70, mid: 30, three: 0 }, target_minutes: 30, traits: ["Floor General", "Rim Protector"], foul_tendency: 7, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Bill Walton")}.png`, era: "Showtime & Three-Point Era (1970s-1980s)" },
            "pete_maravich": { name: "Pete Maravich", pos: "SG", tier: "All-Star", attributes: { inside_scoring: 85, mid_range: 88, three_point: 75, playmaking: 92, perimeter_defense: 70, interior_defense: 40, rebounding: 60, athleticism: 85, basketball_iq: 89 }, career_stats: { usg_pct: 30.5, fg_pct: 44.1 }, shot_tendencies: { inside: 40, mid: 40, three: 20 }, target_minutes: 34, traits: ["Ankle Breaker", "Heat Check"], foul_tendency: 5, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("Pete Maravich")}.png`, era: "Showtime & Three-Point Era (1970s-1980s)" },
            "george_mikan": { name: "George Mikan", pos: "C", tier: "All-Star", attributes: { inside_scoring: 95, mid_range: 70, three_point: 5, playmaking: 65, perimeter_defense: 40, interior_defense: 88, rebounding: 90, athleticism: 70, basketball_iq: 85 }, career_stats: { usg_pct: 30.0, fg_pct: 40.4 }, shot_tendencies: { inside: 90, mid: 10, three: 0 }, target_minutes: 34, traits: ["Post Anchor", "Rim Protector"], foul_tendency: 9, img_url: `https://www.statmuse.com/img/nba/players/${toSlug("George Mikan")}.png`, era: "Pioneers Era (1940s-1960s)" }
        };
        
        // --- MERGED SERVICES ---
        let ai = null;

        const getAI = () => {
            if (ai) return ai;
            if (process.env.API_KEY) {
                ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                return ai;
            }
            return null;
        }

        const generateNewspaperArticle = async (prompt) => {
            const genAI = getAI();
            if (!genAI) {
                console.error("API key is not available. This must be set in the environment variables.");
                return { error: "AI summary is unavailable. Please ensure the API key is configured correctly." };
            }

            try {
                const response = await genAI.models.generateContent({
                    model: 'gemini-2.5-flash',
                    contents: prompt,
                    config: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: Type.OBJECT,
                            properties: {
                                headline: {
                                    type: Type.STRING,
                                    description: "A classic, punchy newspaper headline about the game or series result. Should be dramatic and concise, like 'LAKERS DEFEAT CELTICS IN EPIC FINISH'."
                                },
                                subheadline: {
                                    type: Type.STRING,
                                    description: "A sub-headline focusing on the Game or Series MVP's performance and key stats. e.g., 'LeBron James' Triple-Double Seals the Deal'."
                                },
                                body: {
                                    type: Type.STRING,
                                    description: "The main article body, written in a journalistic style. Use newline characters (\\n) to separate paragraphs. The first paragraph describes the overall narrative. The second explains the key factors or players that led to the victory."
                                }
                            }
                        }
                    }
                });
                
                const parsed = JSON.parse(response.text);
                return parsed;

            } catch (error) {
                console.error("AI Newspaper Article Error:", error);
                return { error: "Sorry, there was an error generating the AI summary. Please check the console for more details." };
            }
        };

        // --- MERGED APP COMPONENTS & LOGIC ---

        const Spinner = () => <div className="spinner mx-auto"></div>;

        const MenuButton = ({ children, className, variant = 'secondary', ...props }) => {
            const baseClasses = 'text-white font-bold py-3 px-8 rounded-lg text-xl transition-all duration-200 ease-in-out shadow-lg transform disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none';
            const variantClasses = {
                primary: 'bg-blue-500 hover:bg-blue-600 hover:-translate-y-1',
                secondary: 'bg-gray-600 border border-gray-500 hover:bg-gray-700 hover:-translate-y-1'
            };
            return (
                <button className={`${baseClasses} ${variantClasses[variant]} ${className}`} {...props}>
                    {children}
                </button>
            );
        };

        const BackButton = ({ onClick }) => (
            <button
                onClick={onClick}
                className="absolute top-4 left-4 bg-gray-700 hover:bg-gray-600 rounded-full w-10 h-10 flex items-center justify-center text-2xl transition z-20"
                aria-label="Go back"
            >
                &larr;
            </button>
        );
        
        const NewspaperMvpCard = ({ mvp }) => (
            <div className="newspaper-mvp-card">
                <img src={mvp.img_url} alt={mvp.name} className="w-24 h-24 rounded-full mr-6 border-2 border-gray-400 p-1" />
                <div className="font-serif">
                    <p className="text-2xl font-bold font-['Playfair_Display']">{mvp.name}</p>
                    <p className="text-lg">{mvp.stats.pts} PTS | {mvp.stats.reb} REB | {mvp.stats.ast} AST</p>
                </div>
            </div>
        );

        const NewspaperBoxScore = ({ team }) => (
            <div className="newspaper-box-score">
                <h5 className="team-name">{team.name}</h5>
                <table>
                    <thead>
                        <tr>
                            <th>Player</th>
                            <th>MIN</th>
                            <th>PTS</th>
                            <th>REB</th>
                            <th>AST</th>
                            <th>PF</th>
                        </tr>
                    </thead>
                    <tbody>
                        {[...team.onCourt, ...team.bench].sort((a,b) => b.stats.mins - a.stats.mins).map(p => (
                            <tr key={p.name}>
                                <td>{p.name}</td>
                                <td>{p.stats.mins}</td>
                                <td>{p.stats.pts}</td>
                                <td>{p.stats.reb}</td>
                                <td>{p.stats.ast}</td>
                                <td>{p.stats.pf}</td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
        );

        const NewspaperSummary = ({ article, gameResult }) => {
            return (
                <div className="newspaper rounded-lg">
                    <header className="newspaper-header">
                        <h1 className="text-4xl font-black tracking-widest">THE LEGENDS LEDGER</h1>
                        <p className="text-sm">YOUR DAILY DOSE OF HOOPS HISTORY</p>
                    </header>
                    <div className="my-4 pt-2">
                         <h2 className="newspaper-headline">{article.headline}</h2>
                         <h3 className="newspaper-subheadline">{article.subheadline}</h3>
                    </div>
                    <hr className="border-t-2 border-gray-400 my-4" />
                    <div className="flex justify-between text-xs text-gray-700 mb-4 font-serif">
                        <span>By A.I. Sports Correspondent</span>
                        <span>{new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</span>
                    </div>
                    <article className="newspaper-body" dangerouslySetInnerHTML={{ __html: article.body.replace(/\n/g, '<br/><br/>') }} />
                
                    {gameResult && (
                        <>
                            <div className="newspaper-divider"></div>
                            <section>
                                <h4 className="newspaper-section-title">Most Valuable Player</h4>
                                <NewspaperMvpCard mvp={gameResult.mvp} />
                            </section>
                            
                            <div className="newspaper-divider"></div>
                            <section>
                                <h4 className="newspaper-section-title">Box Score</h4>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                                    <NewspaperBoxScore team={gameResult.team1} />
                                    <NewspaperBoxScore team={gameResult.team2} />
                                </div>
                            </section>
                        </>
                    )}
                </div>
            );
        };

        const createPlayerInGame = (playerKey) => {
            const player = players[playerKey];
            return {
                ...player,
                stats: { pts: 0, reb: 0, ast: 0, mins: 0, pf: 0 },
                stamina: 100,
            };
        };

        const calculateGameMVP = (allPlayers) => {
            if (!allPlayers || allPlayers.length === 0) {
                const defaultPlayer = Object.values(players)[0];
                return { ...defaultPlayer, stats: { pts: 0, reb: 0, ast: 0, mins: 0, pf: 0}, stamina: 0 };
            }
            return allPlayers.reduce((mvp, p) => {
                const score = p.stats.pts * 1.0 + p.stats.reb * 1.2 + p.stats.ast * 1.5 - p.stats.pf * 2.0;
                const mvpScore = mvp.stats.pts * 1.0 + mvp.stats.reb * 1.2 + mvp.stats.ast * 1.5 - mvp.stats.pf * 2.0;
                return score > mvpScore ? p : mvp;
            });
        };

        const runSingleQuarterLogic = (currentTeams, currentScore, quarterNum, currentLastLeadTeam) => {
            const quarterStats = { plays: [], playerPoints: {}, leadChanges: 0 };
            let localLastLeadTeam = currentLastLeadTeam;
            const qScore = { t1: 0, t2: 0 };
            const t1TotalBefore = Object.values(currentScore).reduce((s, q) => s.t1 + q.t1, 0);
            const t2TotalBefore = Object.values(currentScore).reduce((s, q) => s.t2 + q.t2, 0);

            const teamsAfterQuarter = produce(currentTeams, draft => {
                const possessions = 48;
                for (let i = 0; i < possessions; i++) {
                    const offenseIndex = i % 2;
                    const offense = draft[offenseIndex];
                    const defense = draft[(offenseIndex + 1) % 2];
                    const totalUsage = offense.onCourt.reduce((sum, p) => sum + p.career_stats.usg_pct, 0);
                    let randomUsage = Math.random() * totalUsage;
                    let offensivePlayer = offense.onCourt[0];
                    for (const player of offense.onCourt) {
                        randomUsage -= player.career_stats.usg_pct;
                        if (randomUsage <= 0) { offensivePlayer = player; break; }
                    }
                    const defender = defense.onCourt.find(p => p.pos === offensivePlayer.pos) || defense.onCourt[Math.floor(Math.random() * 5)];
                    offensivePlayer.stamina -= 2;
                    defender.stamina -= 1;
                    const passChance = offensivePlayer.attributes.playmaking - (offensivePlayer.career_stats.usg_pct * 1.5);
                    let shooter;
                    let assister = null;
                    if (Math.random() * 100 < passChance && offense.onCourt.length > 1) {
                        const potentialShooters = offense.onCourt.filter(p => p.name !== offensivePlayer.name);
                        shooter = potentialShooters[Math.floor(Math.random() * potentialShooters.length)];
                        assister = offensivePlayer;
                    } else {
                        shooter = offensivePlayer;
                    }
                    const shotDefender = defense.onCourt.find(p => p.pos === shooter.pos) || defense.onCourt[Math.floor(Math.random() * 5)];
                    const { shot_tendencies } = shooter;
                    const totalShotWeight = shot_tendencies.inside + shot_tendencies.mid + shot_tendencies.three;
                    let randomShot = Math.random() * totalShotWeight;
                    let shotType;
                    if (randomShot < shot_tendencies.inside) shotType = 'inside_scoring';
                    else if (randomShot < shot_tendencies.inside + shot_tendencies.mid) shotType = 'mid_range';
                    else shotType = 'three_point';
                    const offRating = shooter.attributes[shotType] * (shooter.stamina / 100);
                    const defRating = (shotType === 'inside_scoring' ? shotDefender.attributes.interior_defense : shotDefender.attributes.perimeter_defense) * (shotDefender.stamina / 100);
                    const scoreChance = shooter.career_stats.fg_pct + (offRating - defRating) * 0.75;
                    if (Math.random() * 100 < shotDefender.foul_tendency * 2) { shotDefender.stats.pf++; }
                    if (Math.random() * 100 < scoreChance) {
                        const points = shotType === 'three_point' ? 3 : 2;
                        shooter.stats.pts += points;
                        if (offenseIndex === 0) qScore.t1 += points; else qScore.t2 += points;
                        if (assister) assister.stats.ast++;
                        quarterStats.playerPoints[shooter.name] = (quarterStats.playerPoints[shooter.name] || 0) + points;
                        const t1CurrentScore = t1TotalBefore + qScore.t1;
                        const t2CurrentScore = t2TotalBefore + qScore.t2;
                        const currentLeadTeam = t1CurrentScore > t2CurrentScore ? 1 : (t2CurrentScore > t1CurrentScore ? 2 : 0);
                        if (currentLeadTeam !== 0 && currentLeadTeam !== localLastLeadTeam) {
                            quarterStats.leadChanges++;
                            localLastLeadTeam = currentLeadTeam;
                        }
                        quarterStats.plays.push(`<span class="text-green-400">SCORE:</span> ${shooter.name} scores ${points} points ${assister ? `(assist by ${assister.name})` : ''}. (${t1CurrentScore}-${t2CurrentScore})`);
                    } else {
                        const allPlayersOnCourt = [...offense.onCourt, ...defense.onCourt];
                        const totalRebChance = allPlayersOnCourt.reduce((sum, p) => sum + p.attributes.rebounding * (p.stamina / 100), 0);
                        let randomReb = Math.random() * totalRebChance;
                        let rebounder = allPlayersOnCourt[allPlayersOnCourt.length - 1];
                        for (const p of allPlayersOnCourt) {
                            randomReb -= p.attributes.rebounding * (p.stamina / 100);
                            if (randomReb <= 0) { rebounder = p; break; }
                        }
                        rebounder.stats.reb++;
                        quarterStats.plays.push(`<span class="text-yellow-400">MISS:</span> ${shooter.name}'s shot is off. Rebound by ${rebounder.name}.`);
                    }
                }
                draft.forEach(t => t.onCourt.forEach(p => p.stats.mins += 12));
            });
            
            const teamsAfterSubs = produce(teamsAfterQuarter, draft => {
                draft.forEach(team => {
                    team.bench.forEach(p => p.stamina = Math.min(100, p.stamina + 15));
                    for (let i = 0; i < team.onCourt.length; i++) {
                        const tiredPlayer = team.onCourt[i];
                        if (tiredPlayer.stamina < 70 && tiredPlayer.stats.mins < tiredPlayer.target_minutes) {
                            const freshPlayer = team.bench.find(p => p.pos === tiredPlayer.pos && p.stamina > 90);
                            if (freshPlayer) {
                                const tiredIndex = draft.findIndex(t => t.name === team.name);
                                const freshPlayerIndex = team.bench.findIndex(p => p.name === freshPlayer.name);
                                if (tiredIndex !== -1 && freshPlayerIndex !== -1) {
                                    draft[tiredIndex].onCourt[i] = freshPlayer;
                                    draft[tiredIndex].bench[freshPlayerIndex] = tiredPlayer;
                                }
                            }
                        }
                    }
                });
            });

            let star = { name: 'None', points: 0 };
            Object.entries(quarterStats.playerPoints).forEach(([name, points]) => {
                if (points > star.points) { star = { name, points }; }
            });
            const quarterLog = {
                quarter: quarterNum,
                star: star.name !== 'None' ? `${star.name} (${star.points} pts)` : 'Balanced scoring',
                leadChanges: quarterStats.leadChanges,
                plays: quarterStats.plays,
            };

            return { teamsAfterSubs, qScore, quarterLog, nextLastLeadTeam: localLastLeadTeam };
        }

        const HomeScreen = ({ onSelectMode }) => (
            <div className="text-center pt-8 md:pt-16">
                <div className="logo-shape bg-orange-500 w-48 h-48 mx-auto flex items-center justify-center p-4 shadow-lg mb-4">
                    <div className="text-center">
                        <div className="font-black text-3xl text-gray-900 tracking-tighter leading-none">BASKETBALL</div>
                        <div className="font-black text-3xl text-gray-900 tracking-tighter leading-none">LEGENDS</div>
                    </div>
                </div>
                <h1 className="text-3xl font-bold text-gray-200 mt-4">Simulate your dream basketball matchups.</h1>
                <div className="mt-12 flex flex-col md:flex-row justify-center items-center gap-6">
                    <MenuButton onClick={() => onSelectMode(false)}>Single Game</MenuButton>
                    <MenuButton onClick={() => onSelectMode(true)}>Series</MenuButton>
                </div>
            </div>
        );

        const RosterSetupScreen = ({ isSeries, onStartGame, onBack }) => {
            const initialRoster = { starters: {}, bench: {} };
            POSITIONS.forEach(pos => {
                initialRoster.starters[pos] = null;
                initialRoster.bench[pos] = null;
            });

            const [teams, setTeams] = useState([
                { name: 'Showtime Legends', roster: JSON.parse(JSON.stringify(initialRoster)) },
                { name: 'Modern Era Dominators', roster: JSON.parse(JSON.stringify(initialRoster)) }
            ]);
            const [selectedPlayers, setSelectedPlayers] = useState(new Set());
            const [modalOpen, setModalOpen] = useState(false);
            const [activeSlot, setActiveSlot] = useState(null);

            const handlePlayerSelect = (playerKey) => {
                if (!activeSlot) return;
                
                const { teamIndex, type, pos } = activeSlot;
                const oldPlayerKey = teams[teamIndex].roster[type][pos];

                setTeams(produce(draft => {
                    draft[teamIndex].roster[type][pos] = playerKey;
                }));
                
                setSelectedPlayers(prev => {
                    const next = new Set(prev);
                    if (oldPlayerKey) {
                        next.delete(oldPlayerKey);
                    }
                    next.add(playerKey);
                    return next;
                });

                setModalOpen(false);
            };

            const randomizeTeam = (teamIndex) => {
                const availablePlayersByPos = {};
                POSITIONS.forEach(p => availablePlayersByPos[p] = []);

                const otherTeamPlayerKeys = new Set(Object.values(teams[1-teamIndex].roster.starters).concat(Object.values(teams[1-teamIndex].roster.bench)));

                Object.entries(players).forEach(([key, player]) => {
                    if (!otherTeamPlayerKeys.has(key)) {
                        availablePlayersByPos[player.pos].push(key);
                    }
                });

                const newSelectedPlayers = new Set(otherTeamPlayerKeys);
                
                const newTeam = produce(teams[teamIndex], draft => {
                     ['starters', 'bench'].forEach(type => {
                        POSITIONS.forEach(pos => {
                             if (availablePlayersByPos[pos].length > 0) {
                                const randomIndex = Math.floor(Math.random() * availablePlayersByPos[pos].length);
                                const playerKey = availablePlayersByPos[pos].splice(randomIndex, 1)[0];
                                draft.roster[type][pos] = playerKey;
                                newSelectedPlayers.add(playerKey);
                            }
                        });
                    });
                });

                setTeams(produce(draft => {
                    draft[teamIndex] = newTeam;
                }));
                setSelectedPlayers(newSelectedPlayers);
            };
            
            const allSlotsFilled = useMemo(() => selectedPlayers.size >= 20, [selectedPlayers.size]);

            return (
                React.createElement(React.Fragment, null,
                    React.createElement(BackButton, { onClick: onBack }),
                    React.createElement("header", { className: "text-center mb-8" },
                        React.createElement("h1", { className: "text-4xl md:text-5xl font-bold text-amber-400" },
                            isSeries ? 'Build Teams for a 7-Game Series' : 'Build Teams for a Single Game'
                        )
                    ),
                    React.createElement("div", { className: "bg-gray-800 p-6 rounded-xl shadow-lg space-y-8" },
                        teams.map((team, teamIndex) => (
                            React.createElement(React.Fragment, { key: teamIndex },
                                React.createElement("div", { className: "space-y-4" },
                                    React.createElement("div", { className: "flex justify-between items-center" },
                                        React.createElement("input", {
                                            type: "text",
                                            className: "bg-gray-900 text-2xl font-bold text-amber-300 border-none focus:ring-0 w-full",
                                            value: team.name,
                                            onChange: (e) => setTeams(produce(draft => { draft[teamIndex].name = e.target.value; }))
                                        }),
                                        React.createElement(MenuButton, { onClick: () => randomizeTeam(teamIndex), className: "text-sm py-2 px-4 flex-shrink-0" }, "Randomize")
                                    ),
                                    ['starters', 'bench'].map(type => (
                                        React.createElement("div", { key: type },
                                            React.createElement("h4", { className: "text-lg font-semibold mb-2 border-b border-gray-600 pb-1 capitalize" }, type),
                                            React.createElement("div", { className: "grid grid-cols-2 md:grid-cols-5 gap-4" },
                                                POSITIONS.map(pos => {
                                                    const playerKey = team.roster[type][pos];
                                                    const player = playerKey ? players[playerKey] : null;
                                                    const slotClasses = `h-24 rounded-lg flex flex-col items-center justify-center p-2 transition-all duration-200 ease-in-out border-2 ${player ? 'border-solid border-blue-500 bg-slate-900' : 'border-dashed border-gray-700 bg-gray-800 hover:border-blue-400 hover:bg-gray-600'}`;

                                                    return (
                                                        React.createElement("button", { key: pos, className: slotClasses, onClick: () => { setActiveSlot({ teamIndex, type, pos }); setModalOpen(true); } },
                                                            player ? (
                                                                React.createElement(React.Fragment, null,
                                                                    React.createElement("img", { src: player.img_url, alt: player.name, className: "w-12 h-12 rounded-full mx-auto mb-1" }),
                                                                    React.createElement("span", { className: "font-bold text-white text-xs text-center block truncate w-full" }, player.name),
                                                                    React.createElement("span", { className: "text-xs text-gray-400" }, pos)
                                                                )
                                                            ) : (
                                                                React.createElement(React.Fragment, null,
                                                                    React.createElement("span", { className: "font-bold text-gray-400" }, pos),
                                                                    React.createElement("span", { className: "text-sm text-gray-500 mt-1" }, "+ Add Player")
                                                                )
                                                            )
                                                        )
                                                    )
                                                })
                                            )
                                        )
                                    ))
                                ),
                                teamIndex === 0 && React.createElement("hr", { className: "border-gray-600" })
                            )
                        ))
                    ),
                     React.createElement("div", { className: "text-center mt-6" },
                        React.createElement(MenuButton, { variant: "primary", onClick: () => onStartGame(teams), disabled: !allSlotsFilled, title: !allSlotsFilled ? 'Please fill all 20 roster spots' : '' },
                            isSeries ? 'Start Series' : 'Start Game'
                        )
                    ),
                    modalOpen && activeSlot && React.createElement(PlayerModal, { onClose: () => setModalOpen(false), onSelect: handlePlayerSelect, positionFilter: activeSlot.pos, selectedPlayers: selectedPlayers })
                )
            );
        };

        const PlayerModal = ({ onClose, onSelect, positionFilter, selectedPlayers }) => {
            const [searchTerm, setSearchTerm] = useState('');
            const [tierFilter, setTierFilter] = useState('All');

            const filteredPlayers = useMemo(() => {
                return Object.entries(players).filter(([key, p]) => {
                    const posMatch = p.pos === positionFilter;
                    const nameMatch = p.name.toLowerCase().includes(searchTerm.toLowerCase());
                    const tierMatch = tierFilter === 'All' || p.tier === tierFilter;
                    return posMatch && nameMatch && tierMatch;
                });
            }, [positionFilter, searchTerm, tierFilter]);

            return (
                React.createElement("div", { className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80" },
                    React.createElement("div", { className: "bg-gray-800 rounded-lg shadow-2xl max-w-md w-full max-h-[80vh] flex flex-col" },
                        React.createElement("div", { className: "p-4 border-b border-gray-700" },
                            React.createElement("h3", { className: "text-xl font-bold" }, `Select a ${positionFilter}`),
                            React.createElement("input", { type: "text", value: searchTerm, onChange: e => setSearchTerm(e.target.value), className: "w-full p-2 mt-2 bg-gray-700 rounded-md", placeholder: "Search by name..." }),
                            React.createElement("div", { className: "flex gap-2 mt-2" },
                                ['All', 'GOAT', 'Legend', 'All-Star'].map(tier => (
                                    React.createElement("button", { key: tier, onClick: () => setTierFilter(tier), className: `p-2 rounded-md text-sm ${tierFilter === tier ? 'bg-amber-500' : 'bg-gray-600'}` }, tier)
                                ))
                            )
                        ),
                        React.createElement("div", { className: "p-4 grid grid-cols-1 sm:grid-cols-2 gap-2 overflow-y-auto" },
                            filteredPlayers.map(([key, p]) => {
                                const isSelected = selectedPlayers.has(key);
                                return (
                                    React.createElement("button", { key: key, onClick: () => onSelect(key), disabled: isSelected, className: `p-3 rounded-lg text-left ${isSelected ? 'bg-gray-600 text-gray-400 cursor-not-allowed' : 'bg-gray-700 hover:bg-amber-600'}` },
                                        React.createElement("div", { className: "flex items-center" },
                                            React.createElement("img", { src: p.img_url, alt: p.name, className: "w-8 h-8 rounded-full mr-3" }),
                                            React.createElement("div", { className: "flex-1" },
                                                React.createElement("div", null, p.name),
                                                React.createElement("div", { className: "text-xs text-gray-400" }, p.tier)
                                            )
                                        )
                                    )
                                );
                            })
                        ),
                        React.createElement("div", { className: "p-4 border-t border-gray-700" },
                            React.createElement("button", { onClick: onClose, className: "w-full bg-red-600 hover:bg-red-700 p-2 rounded-lg" }, "Cancel")
                        )
                    )
                )
            );
        };
        
        const GamePlayScreen = ({ teams, onGameEnd, onBack, gameNumber = 1 }) => {
            const initializeTeams = useCallback(() => {
                return teams.map(team => ({
                    name: team.name,
                    onCourt: Object.values(team.roster.starters).filter(pk => !!pk).map(pk => createPlayerInGame(pk)),
                    bench: Object.values(team.roster.bench).filter(pk => !!pk).map(pk => createPlayerInGame(pk)),
                    roster: {
                        starters: Object.values(team.roster.starters).filter(pk => !!pk).map(pk => players[pk]),
                        bench: Object.values(team.roster.bench).filter(pk => !!pk).map(pk => players[pk])
                    }
                }));
            }, [teams]);
            
            const [gameTeams, setGameTeams] = useState(initializeTeams);
            const [score, setScore] = useState({ q1: {t1:0, t2:0}, q2: {t1:0, t2:0}, q3: {t1:0, t2:0}, q4: {t1:0, t2:0} });
            const [currentQuarter, setCurrentQuarter] = useState(1);
            const [playByPlay, setPlayByPlay] = useState([]);
            const [lastLeadTeam, setLastLeadTeam] = useState(0);
            const [isSimulating, setIsSimulating] = useState(false);

            const runQuarterSimulation = useCallback(() => {
                setIsSimulating(true);
                setTimeout(() => {
                    const { teamsAfterSubs, qScore, quarterLog, nextLastLeadTeam } = runSingleQuarterLogic(gameTeams, score, currentQuarter, lastLeadTeam);
                    
                    setGameTeams(teamsAfterSubs);
                    setScore(s => ({ ...s, [`q${currentQuarter}`]: qScore }));
                    setPlayByPlay(p => [quarterLog, ...p]);
                    setLastLeadTeam(nextLastLeadTeam);
                    setCurrentQuarter(q => q + 1);
                    setIsSimulating(false);
                }, 500);
            }, [currentQuarter, gameTeams, lastLeadTeam, score]);

            const handleSimulateFullGame = useCallback(() => {
                setIsSimulating(true);
                setTimeout(() => {
                    let currentSimTeams = gameTeams;
                    let currentSimScore = score;
                    let currentSimPBP = [...playByPlay];
                    let currentSimLastLead = lastLeadTeam;

                    for (let q = currentQuarter; q <= 4; q++) {
                        const { teamsAfterSubs, qScore, quarterLog, nextLastLeadTeam } = runSingleQuarterLogic(currentSimTeams, currentSimScore, q, currentSimLastLead);
                        currentSimTeams = teamsAfterSubs;
                        currentSimScore = { ...currentSimScore, [`q${q}`]: qScore };
                        currentSimPBP = [quarterLog, ...currentSimPBP];
                        currentSimLastLead = nextLastLeadTeam;
                    }

                    setGameTeams(currentSimTeams);
                    setScore(currentSimScore);
                    setPlayByPlay(currentSimPBP);
                    setLastLeadTeam(currentSimLastLead);
                    setCurrentQuarter(5);
                    setIsSimulating(false);
                }, 500);
            }, [currentQuarter, gameTeams, lastLeadTeam, playByPlay, score]);

            const handleFinalize = () => {
                const t1_final_score = Object.values(score).reduce((s, q) => s + q.t1, 0);
                const t2_final_score = Object.values(score).reduce((s, q) => s + q.t2, 0);
                const winner = t1_final_score >= t2_final_score ? gameTeams[0] : gameTeams[1];
                const allPlayers = [...gameTeams[0].onCourt, ...gameTeams[0].bench, ...gameTeams[1].onCourt, ...gameTeams[1].bench];
                const mvp = calculateGameMVP(allPlayers);
                onGameEnd({
                    gameNumber,
                    winner,
                    score: `${Math.max(t1_final_score, t2_final_score)} - ${Math.min(t1_final_score, t2_final_score)}`,
                    team1: gameTeams[0],
                    team2: gameTeams[1],
                    halftimeScore: `${score.q1.t1 + score.q2.t1} - ${score.q1.t2 + score.q2.t2}`,
                    leadChanges: playByPlay.reduce((acc, q) => acc + q.leadChanges, 0),
                    mvp
                });
            };

            const t1_total = Object.values(score).reduce((s, q) => s + q.t1, 0);
            const t2_total = Object.values(score).reduce((s, q) => s + q.t2, 0);

            return React.createElement(React.Fragment, null,
                React.createElement(BackButton, { onClick: onBack }),
                React.createElement("header", { className: "text-center mb-4" },
                    React.createElement("h1", { className: "text-3xl font-bold" }, `Game ${gameNumber}`),
                    React.createElement("p", { className: "text-6xl font-black my-1" }, `${t1_total} - ${t2_total}`)
                ),
                React.createElement("div", { className: "bg-gray-800 p-4 rounded-xl shadow-lg max-w-2xl mx-auto" },
                    React.createElement("table", { className: "w-full text-center" },
                        React.createElement("thead", null, React.createElement("tr", { className: "border-b border-gray-600" }, React.createElement("th", { className: "p-2" }, "Team"), React.createElement("th", null, "Q1"), React.createElement("th", null, "Q2"), React.createElement("th", null, "Q3"), React.createElement("th", null, "Q4"), React.createElement("th", null, "Total"))),
                        React.createElement("tbody", null,
                            React.createElement("tr", null, React.createElement("td", { className: "p-2 text-left font-bold text-blue-400" }, teams[0].name), React.createElement("td", null, score.q1.t1), React.createElement("td", null, score.q2.t1), React.createElement("td", null, score.q3.t1), React.createElement("td", null, score.q4.t1), React.createElement("td", { className: "font-bold" }, t1_total)),
                            React.createElement("tr", null, React.createElement("td", { className: "p-2 text-left font-bold text-orange-400" }, teams[1].name), React.createElement("td", null, score.q1.t2), React.createElement("td", null, score.q2.t2), React.createElement("td", null, score.q3.t2), React.createElement("td", null, score.q4.t2), React.createElement("td", { className: "font-bold" }, t2_total))
                        )
                    )
                ),
                React.createElement("div", { className: "mt-6 bg-gray-800 p-4 rounded-xl shadow-lg max-w-2xl mx-auto space-y-2" },
                    React.createElement("h3", { className: "text-xl font-bold mb-2 text-center text-amber-400" }, "Play-by-Play Recap"),
                    playByPlay.length > 0 ? playByPlay.map(q =>
                        React.createElement("div", { key: q.quarter, className: "mb-4" },
                            React.createElement("div", { className: "p-2 bg-gray-700 rounded-t-lg font-bold text-amber-300 flex justify-between text-sm" },
                                React.createElement("span", null, `Q${q.quarter} Summary`),
                                React.createElement("span", null, `Star: ${q.star}`),
                                React.createElement("span", null, `Lead Changes: ${q.leadChanges}`)
                            ),
                            React.createElement("ul", { className: "text-sm p-3 bg-gray-900 rounded-b-lg space-y-1 max-h-48 overflow-y-auto" },
                                q.plays.length > 0 ?
                                    q.plays.slice().reverse().map((play, index) => React.createElement("li", { key: index, dangerouslySetInnerHTML: { __html: play } })) :
                                    React.createElement("li", null, "No significant plays in this quarter.")
                            )
                        )
                    ) : React.createElement("p", { className: "text-center text-gray-400" }, "Simulate a quarter to see the action.")
                ),
                React.createElement("div", { className: "text-center mt-6 flex justify-center gap-4" },
                    currentQuarter <= 4 ? React.createElement(React.Fragment, null,
                        React.createElement(MenuButton, { variant: "primary", onClick: runQuarterSimulation, disabled: isSimulating }, isSimulating ? 'Simulating...' : `Simulate Q${currentQuarter}`),
                        React.createElement(MenuButton, { onClick: handleSimulateFullGame, disabled: isSimulating }, isSimulating ? 'Simulating...' : 'Sim Game')
                    ) : React.createElement(MenuButton, { variant: "primary", onClick: handleFinalize }, "Finalize Game")
                )
            );
        };
        
        const SeriesScreen = ({ initialTeams, onSeriesEnd, onBack, onHome }) => {
            const [team1, setTeam1] = useState(() => ({ ...initializeTeamForSeries(initialTeams[0]), wins: 0, seriesStats: initializeSeriesStats(initialTeams[0]) }));
            const [team2, setTeam2] = useState(() => ({ ...initializeTeamForSeries(initialTeams[1]), wins: 0, seriesStats: initializeSeriesStats(initialTeams[1]) }));
            const [gameLog, setGameLog] = useState([]);
            const [gameResults, setGameResults] = useState([]);
            const [simulating, setSimulating] = useState(false);

            const gameNumber = team1.wins + team2.wins + 1;

            useEffect(() => {
                if (team1.wins >= 4 || team2.wins >= 4) {
                    const winner = team1.wins > team2.wins ? team1 : team2;
                    const loser = team1.wins > team2.wins ? team2 : team1;
                    onSeriesEnd(winner, loser, gameResults);
                }
            }, [team1.wins, team2.wins, gameResults, onSeriesEnd, team1, team2]);

            const handleGameEnd = (result) => {
                const updatedGameLog = React.createElement(SeriesLogItem, { key: gameNumber, result: result });
                setGameLog(prev => [updatedGameLog, ...prev]);
                setGameResults(prev => [...prev, result]);

                const updateStats = (currentTeam, gameTeam) => {
                    return produce(currentTeam.seriesStats, draft => {
                        [...gameTeam.onCourt, ...gameTeam.bench].forEach(p => {
                            if (draft[p.name]) {
                                draft[p.name].pts += p.stats.pts;
                                draft[p.name].reb += p.stats.reb;
                                draft[p.name].ast += p.stats.ast;
                                draft[p.name].pf += p.stats.pf;
                            }
                        });
                    });
                };

                if (result.winner.name === team1.name) {
                    setTeam1(t => ({...t, wins: t.wins + 1, seriesStats: updateStats(t, result.team1)}));
                    setTeam2(t => ({...t, seriesStats: updateStats(t, result.team2)}));
                } else {
                    setTeam2(t => ({...t, wins: t.wins + 1, seriesStats: updateStats(t, result.team2)}));
                    setTeam1(t => ({...t, seriesStats: updateStats(t, result.team1)}));
                }
                setSimulating(false);
            };
            
            if (simulating) {
                return React.createElement(GamePlayScreen, { teams: initialTeams, onGameEnd: handleGameEnd, onBack: () => setSimulating(false), gameNumber: gameNumber });
            }
            
            return React.createElement(React.Fragment, null,
                React.createElement(BackButton, { onClick: onBack }),
                React.createElement("header", { className: "text-center mb-6" },
                    React.createElement("h1", { className: "text-3xl font-bold" }, "Best-of-7 Series"),
                    React.createElement("p", { className: "text-6xl font-black my-2" }, React.createElement("span", { className: "text-blue-400" }, team1.wins), " - ", React.createElement("span", { className: "text-orange-400" }, team2.wins))
                ),
                React.createElement("div", { className: "bg-gray-800 p-6 rounded-xl shadow-lg min-h-[200px] max-w-4xl mx-auto" },
                    React.createElement("h3", { className: "text-xl font-bold mb-4" }, "Series Log"),
                    React.createElement("ul", { className: "text-gray-300 space-y-4" }, gameLog.length > 0 ? gameLog : React.createElement("p", null, "No games played yet."))
                ),
                React.createElement("div", { className: "text-center mt-6" },
                    React.createElement(MenuButton, { variant: "primary", onClick: () => setSimulating(true) }, `Simulate Game ${gameNumber}`)
                )
            );
        };
        
        function initializeTeamForSeries(team) {
            return {
                name: team.name,
                onCourt: [],
                bench: [],
                roster: {
                    starters: Object.values(team.roster.starters).filter(pk => !!pk).map(pk => players[pk]),
                    bench: Object.values(team.roster.bench).filter(pk => !!pk).map(pk => players[pk])
                }
            };
        }
        function initializeSeriesStats(team) {
            const stats = {};
            [...Object.values(team.roster.starters), ...Object.values(team.roster.bench)].forEach(pk => {
                if(pk) stats[players[pk].name] = { pts: 0, reb: 0, ast: 0, pf: 0 };
            });
            return stats;
        }
        function calculateSeriesMVP(winner) {
            let mvp = {name: '', stats: {pts:0,reb:0,ast:0,pf:0, img_url:''}};
            let maxScore = -1;

            Object.entries(winner.seriesStats).forEach(([playerName, stats]) => {
                const mvpScore = stats.pts * 1.0 + stats.reb * 1.2 + stats.ast * 1.5 - stats.pf * 2.0;
                if (mvpScore > maxScore) {
                    maxScore = mvpScore;
                    const playerInfo = Object.values(players).find(p => p.name === playerName);
                    mvp = { name: playerName, stats: {...stats, img_url: playerInfo?.img_url || '' }};
                }
            });
            return mvp;
        }

        const SeriesLogItem = ({result}) => (
            React.createElement("li", { className: "border-b border-gray-700 pb-3 mb-3" },
                React.createElement("div", { className: "flex justify-between items-center" },
                    React.createElement("p", { className: "font-bold text-lg" }, `${result.winner.name} wins Game ${result.gameNumber}, ${result.score}`)
                ),
                React.createElement("div", { className: "text-sm text-gray-400 mt-2" },
                    React.createElement("span", null, React.createElement("strong", null, "Game MVP:"), ` ${result.mvp.name} (${result.mvp.stats.pts} PTS, ${result.mvp.stats.reb} REB, ${result.mvp.stats.ast} AST)`)
                )
            )
        )
        
        const AiSummaryScreen = ({ result, onRematch, onNewGame, onHome }) => {
            const [article, setArticle] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [error, setError] = useState('');
            const isGameResult = 'mvp' in result;

            const getBackButtonAction = () => {
                if(isGameResult && onNewGame) return onNewGame;
                return onHome;
            }

            const prompt = useMemo(() => {
                if (isGameResult) {
                     return `
                        You are a sports journalist for a classic newspaper.
                        Write an article based on the following game details.
                        - Team 1: "${result.team1.name}"
                        - Team 2: "${result.team2.name}"
                        - Final Score: ${result.score}
                        - Winner: ${result.winner.name}
                        - Game MVP: ${result.mvp.name} (${result.mvp.stats.pts} PTS, ${result.mvp.stats.reb} REB, ${result.mvp.stats.ast} AST)
                        - Game Flow: Halftime score was ${result.halftimeScore}. Total lead changes: ${result.leadChanges}.
                    `;
                } else { // Series Result
                    const { winner, loser, gameResults } = result;
                    const seriesMVP = calculateSeriesMVP(winner);
                    const gameNumber = gameResults.length;
                    return `
                        You are a sports journalist for a classic newspaper.
                        Write an article summarizing an entire basketball series based on the following details.
                        - Series Winner: "${winner.name}" (${winner.wins} wins)
                        - Series Loser: "${loser.name}" (${loser.wins} wins)
                        - Series MVP: ${seriesMVP.name}, averaging ${(seriesMVP.stats.pts / gameNumber).toFixed(1)} PPG, ${(seriesMVP.stats.reb / gameNumber).toFixed(1)} RPG, and ${(seriesMVP.stats.ast / gameNumber).toFixed(1)} APG.
                        - Key Player from Loser: Maybe mention a standout player from the losing team.
                        - Game Scores: ${gameResults.map((game, index) => `G${index + 1}: ${game.score}`).join(', ')}.
                    `;
                }
            }, [result, isGameResult]);
            
            useEffect(() => {
                const fetchArticle = async () => {
                    setIsLoading(true);
                    setError('');
                    const res = await generateNewspaperArticle(prompt);
                    if('error' in res) setError(res.error);
                    else setArticle(res);
                    setIsLoading(false);
                }
                fetchArticle();
            }, [prompt]);

            return React.createElement(React.Fragment, null,
                React.createElement(BackButton, { onClick: getBackButtonAction() }),
                React.createElement("header", { className: "text-center mb-6" },
                    React.createElement("h1", { className: "text-3xl font-bold text-amber-400" }, "Final Results")
                ),
                React.createElement("div", { className: "max-w-4xl mx-auto" },
                    isLoading && React.createElement("div", { className: "flex justify-center items-center h-96" }, React.createElement(Spinner, null)),
                    error && React.createElement("div", { className: "text-center text-red-400 p-8 bg-gray-800 rounded-lg" }, error),
                    article && React.createElement(NewspaperSummary, { article: article, gameResult: isGameResult ? result : undefined })
                ),
                React.createElement("div", { className: "text-center mt-6 flex flex-wrap justify-center gap-4" },
                    isGameResult ? React.createElement(React.Fragment, null,
                        onRematch && React.createElement(MenuButton, { onClick: onRematch }, "Rematch"),
                        onNewGame && React.createElement(MenuButton, { onClick: onNewGame }, "New Game"),
                        React.createElement(MenuButton, { onClick: onHome }, "Main Menu")
                    ) : React.createElement(MenuButton, { onClick: onHome }, "Main Menu")
                )
            );
        };
        
        const App = () => {
            const Screen = { Home: 0, RosterSetup: 1, Series: 2, SingleGame: 3, AiSummary: 4 };
            const [screen, setScreen] = useState(Screen.Home);
            const [teams, setTeams] = useState(null);
            const [isSeries, setIsSeries] = useState(false);
            const [gameResult, setGameResult] = useState(null);
            const [seriesResult, setSeriesResult] = useState(null);

            useEffect(() => {
                window.scrollTo(0, 0);
            }, [screen]);

            const handleSelectMode = useCallback((series) => {
                setIsSeries(series);
                setScreen(Screen.RosterSetup);
            }, []);

            const handleStartGame = useCallback((newTeams) => {
                setTeams(newTeams);
                setScreen(isSeries ? Screen.Series : Screen.SingleGame);
            }, [isSeries]);

            const handleGameEnd = useCallback((result) => {
                setGameResult(result);
                setScreen(Screen.AiSummary);
            }, []);

            const handleSeriesEnd = (winner, loser, gameResults) => {
                setSeriesResult({ winner, loser, gameResults });
                setScreen(Screen.AiSummary);
            };
            
            const handleReset = useCallback(() => {
                setScreen(Screen.Home);
                setTeams(null);
                setGameResult(null);
                setSeriesResult(null);
            }, []);

            const handleRematch = useCallback(() => {
                setGameResult(null);
                setSeriesResult(null);
                setScreen(isSeries ? Screen.Series : Screen.SingleGame);
            }, [isSeries]);

            const handleNewGame = useCallback(() => {
                setGameResult(null);
                setSeriesResult(null);
                setTeams(null);
                setScreen(Screen.RosterSetup);
            }, []);

            const renderScreen = () => {
                switch (screen) {
                    case Screen.Home: return React.createElement(HomeScreen, { onSelectMode: handleSelectMode });
                    case Screen.RosterSetup: return React.createElement(RosterSetupScreen, { isSeries: isSeries, onStartGame: handleStartGame, onBack: handleReset });
                    case Screen.Series: return teams ? React.createElement(SeriesScreen, { initialTeams: teams, onSeriesEnd: handleSeriesEnd, onBack: () => setScreen(Screen.RosterSetup), onHome: handleReset}) : null;
                    case Screen.SingleGame: return teams ? React.createElement(GamePlayScreen, { teams: teams, onGameEnd: handleGameEnd, onBack: () => setScreen(Screen.RosterSetup) }) : null;
                    case Screen.AiSummary:
                        if (gameResult && !isSeries) return React.createElement(AiSummaryScreen, { result: gameResult, onRematch: handleRematch, onNewGame: handleNewGame, onHome: handleReset });
                        if (seriesResult) return React.createElement(AiSummaryScreen, { result: seriesResult, onHome: handleReset });
                        return null;
                    default: return React.createElement(HomeScreen, { onSelectMode: handleSelectMode });
                }
            };

            return React.createElement("div", { className: "container mx-auto p-4 md:p-8 max-w-5xl relative min-h-screen" }, renderScreen());
        };

        const rootElement = document.getElementById('root');
        if (!rootElement) {
          throw new Error("Could not find root element to mount to");
        }

        const root = ReactDOM.createRoot(rootElement);
        root.render(
          React.createElement(React.StrictMode, null, React.createElement(App, null))
        );
    </script>
</body>
</html>
